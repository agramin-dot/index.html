<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اپلیکیشن تصحیح خودکار پاسخنامه استاندارد</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
        :root{
            --primary:#4a00e0;
            --secondary:#8e2de2;
            --accent:#00b09b;
            --danger:#dc3545;
            --warning:#ffc107;
            --light:#f5f7fa;
            --dark:#333;
            --success:#28a745;
            --info:#17a2b8
        }
        body{
            background:linear-gradient(135deg,var(--primary) 0%,var(--secondary) 100%);
            color:var(--dark);
            min-height:100vh;
            padding:20px;
            transition:all 0.3s ease;
        }
        .container{
            max-width:1200px;
            margin:0 auto;
            background:rgba(255,255,255,.95);
            border-radius:15px;
            box-shadow:0 10px 30px rgba(0,0,0,.15);
            overflow:hidden;
            transition:all 0.3s ease;
        }
        header{
            background:linear-gradient(to right,var(--primary),var(--secondary));
            color:white;
            text-align:center;
            padding:25px 20px;
            position:relative;
            transition:all 0.3s ease;
        }
        header h1{
            font-size:1.8rem;
            margin-bottom:10px;
            transition:all 0.3s ease;
        }
        header p{
            font-size:1rem;
            opacity:.9;
            transition:all 0.3s ease;
        }
        .tabs{
            display:flex;
            background:var(--light);
            transition:all 0.3s ease;
        }
        .tab-btn{
            flex:1;
            padding:15px;
            border:none;
            cursor:pointer;
            font-weight:600;
            transition:all .3s ease;
            position:relative;
            overflow:hidden;
        }
        .tab-btn:hover{
            background:rgba(255,255,255,0.7);
        }
        .tab-btn.active{
            background:white;
            color:var(--primary);
            border-bottom:3px solid var(--primary);
        }
        .tab-btn .badge{
            position:absolute;
            top:5px;
            left:5px;
            background:var(--danger);
            color:white;
            border-radius:50%;
            width:18px;
            height:18px;
            font-size:10px;
            display:flex;
            align-items:center;
            justify-content:center;
        }
        .tab-content{
            display:none;
            padding:25px;
            animation:fadeIn 0.5s ease;
            transition:all 0.3s ease;
        }
        .tab-content.active{
            display:block;
        }
        @keyframes fadeIn{
            from{opacity:0;transform:translateY(10px)}
            to{opacity:1;transform:translateY(0)}
        }
        #camera-view{
            width:100%;
            height:400px;
            background:#000;
            position:relative;
            display:flex;
            justify-content:center;
            align-items:center;
            color:white;
            border-radius:8px;
            overflow:hidden;
            transition:all 0.3s ease;
        }
        .controls{
            display:flex;
            gap:10px;
            margin-top:10px;
            flex-wrap:wrap;
            transition:all 0.3s ease;
        }
        button{
            padding:10px 15px;
            border:none;
            border-radius:8px;
            cursor:pointer;
            font-weight:600;
            transition:all 0.3s ease;
            position:relative;
            overflow:hidden;
        }
        button:after{
            content:'';
            position:absolute;
            top:50%;
            left:50%;
            width:5px;
            height:5px;
            background:rgba(255,255,255,0.5);
            opacity:0;
            border-radius:100%;
            transform:scale(1,1) translate(-50%);
            transform-origin:50% 50%;
        }
        button:focus:not(:active)::after{
            animation:ripple 1s ease-out;
        }
        @keyframes ripple{
            0%{transform:scale(0,0);opacity:1;}
            100%{transform:scale(20,20);opacity:0;}
        }
        .btn-primary{background:var(--primary);color:white}
        .btn-primary:hover{background:#3a00c0;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.2)}
        .btn-success{background:var(--accent);color:white}
        .btn-success:hover{background:#00a08b;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.2)}
        .btn-danger{background:var(--danger);color:white}
        .btn-danger:hover{background:#c82333;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.2)}
        .btn-warning{background:var(--warning);color:var(--dark)}
        .btn-warning:hover{background:#e0a800;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.2)}
        .btn-secondary{background:#6c757d;color:white}
        .btn-secondary:hover{background:#5a6268;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.2)}
        .btn-info{background:var(--info);color:white}
        .btn-info:hover{background:#138496;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.2)}
        .results-section{
            background:#f0f9ff;
            padding:20px;
            border-radius:10px;
            margin-top:20px;
            display:none;
            animation:fadeIn 0.5s ease;
            transition:all 0.3s ease;
        }
        .answer-item{
            display:inline-block;
            margin:5px;
            padding:10px;
            border-radius:5px;
            font-weight:bold;
            min-width:40px;
            text-align:center;
            transition:all 0.3s ease;
        }
        .correct{background:#d4edda;color:#155724}
        .incorrect{background:#f8d7da;color:#721c24}
        .empty{background:#f8f9fa;color:#6c757d}
        .a5-container{
            width:148mm;
            height:210mm;
            padding:10mm;
            margin:20px auto;
            background:white;
            box-shadow:0 0 10px rgba(0,0,0,.1);
            position:relative;
            page-break-inside:avoid;
            box-sizing:border-box;
            transition:all 0.3s ease;
        }
        .sheet-marker{
            position:absolute;
            width:10px;
            height:10px;
            background:black;
            border:2px solid white;
            box-shadow:0 0 0 2px black;
            z-index:10;
            transition:all 0.3s ease;
        }
        .sheet-marker.tl{top:3mm;left:3mm}
        .sheet-marker.tr{top:3mm;right:3mm}
        .sheet-marker.bl{bottom:3mm;left:3mm}
        .sheet-marker.br{bottom:3mm;right:3mm}
        .student-info{
            display:grid;
            grid-template-columns:1fr 1fr;
            gap:3px;
            margin-bottom:8px;
            font-size:11px;
            transition:all 0.3s ease;
        }
        .info-item{
            display:flex;
            align-items:center;
            transition:all 0.3s ease;
        }
        .info-item label{
            width:80px;
            font-weight:bold;
            transition:all 0.3s ease;
        }
        .info-item span{
            flex:1;
            border-bottom:1px dashed #999;
            height:15px;
            transition:all 0.3s ease;
        }
        .questions-grid{
            display:grid;
            grid-template-columns:repeat(4, 1fr);
            gap:4px;
            margin-top:10px;
            transition:all 0.3s ease;
        }
        .question-cell{
            text-align:center;
            padding:3px;
            border:1px solid #ddd;
            border-radius:3px;
            font-size:10px;
            min-height:45px;
            display:flex;
            flex-direction:column;
            justify-content:space-between;
            transition:all 0.3s ease;
        }
        .question-number{
            font-weight:bold;
            margin-bottom:3px;
            font-size:11px;
            transition:all 0.3s ease;
        }
        .option-bubbles{
            display:flex;
            justify-content:center;
            gap:2px;
            transition:all 0.3s ease;
        }
        .option-bubble{
            width:14px;
            height:14px;
            border:1px solid #333;
            border-radius:50%;
            display:inline-flex;
            justify-content:center;
            align-items:center;
            font-size:9px;
            cursor:pointer;
            transition:all 0.3s ease;
        }
        .option-bubble:hover{
            transform:scale(1.1);
            box-shadow:0 0 5px rgba(0,0,0,0.3);
        }
        .option-bubble.filled::after{
            content:'';
            width:10px;
            height:10px;
            background:black;
            border-radius:50%;
            transition:all 0.3s ease;
        }
        .option-bubble.correct-answer{
            border-color:var(--success);
            box-shadow:0 0 0 1px var(--success);
        }
        .results-summary{
            margin-top:10px;
            padding:10px;
            border:1px solid #ddd;
            border-radius:4px;
            background:#f9f9f9;
            font-size:12px;
            transition:all 0.3s ease;
        }
        .summary-grid{
            display:grid;
            grid-template-columns:1fr 1fr;
            gap:5px;
            transition:all 0.3s ease;
        }
        .file-input-container{
            margin:15px 0;
            transition:all 0.3s ease;
        }
        .file-input-container label{
            display:block;
            margin-bottom:5px;
            font-weight:600;
            transition:all 0.3s ease;
        }
        .file-input-container input{
            width:100%;
            padding:8px;
            border:1px solid #ddd;
            border-radius:4px;
            transition:all 0.3s ease;
        }
        .file-input-container input:focus{
            border-color:var(--primary);
            box-shadow:0 0 0 2px rgba(74,0,224,0.2);
            outline:none;
        }
        .progress-container{
            margin:15px 0;
            transition:all 0.3s ease;
        }
        .progress-bar{
            width:100%;
            height:20px;
            background:#eee;
            border-radius:10px;
            overflow:hidden;
            transition:all 0.3s ease;
        }
        .progress{
            height:100%;
            background:var(--accent);
            width:0%;
            transition:width .3s ease;
        }
        .status-text{
            margin-top:5px;
            font-size:.9rem;
            text-align:center;
            transition:all 0.3s ease;
        }
        .status-text.error{color:var(--danger)}
        .status-text.warning{color:var(--warning)}
        .status-text.success{color:var(--success)}
        .status-text.info{color:var(--info)}
        .results-table{
            width:100%;
            border-collapse:collapse;
            margin-top:15px;
            transition:all 0.3s ease;
        }
        .results-table th,.results-table td{
            padding:10px;
            text-align:center;
            border:1px solid #ddd;
            transition:all 0.3s ease;
        }
        .results-table th{
            background:var(--light);
            transition:all 0.3s ease;
        }
        .results-table tr:hover{
            background-color:rgba(0,0,0,0.02);
        }
        .settings-grid{
            display:grid;
            grid-template-columns:1fr 1fr;
            gap:15px;
            transition:all 0.3s ease;
        }
        .setting-item{
            margin-bottom:15px;
            transition:all 0.3s ease;
        }
        .setting-item label{
            display:block;
            margin-bottom:5px;
            font-weight:600;
            transition:all 0.3s ease;
        }
        .setting-item input,.setting-item select{
            width:100%;
            padding:8px;
            border:1px solid #ddd;
            border-radius:4px;
            transition:all 0.3s ease;
        }
        .setting-item input:focus,.setting-item select:focus{
            border-color:var(--primary);
            box-shadow:0 0 0 2px rgba(74,0,224,0.2);
            outline:none;
        }
        .instructions{
            background:#f0f9ff;
            padding:15px;
            border-radius:8px;
            margin-top:20px;
            font-size:.9rem;
            transition:all 0.3s ease;
        }
        .instructions ol{
            padding-right:20px;
            margin-top:10px;
            transition:all 0.3s ease;
        }
        .instructions li{
            margin-bottom:5px;
            transition:all 0.3s ease;
        }
        .manual-answers{
            background:#f8f9fa;
            padding:15px;
            border-radius:8px;
            margin-top:15px;
            transition:all 0.3s ease;
        }
        .manual-answers-grid{
            display:grid;
            grid-template-columns:repeat(auto-fill, minmax(80px, 1fr));
            gap:10px;
            margin-top:10px;
            transition:all 0.3s ease;
        }
        .manual-answer-item{
            text-align:center;
            transition:all 0.3s ease;
        }
        .manual-answer-item select{
            width:100%;
            text-align:center;
            font-weight:bold;
            padding:5px;
            transition:all 0.3s ease;
        }
        .camera-options{
            display:flex;
            gap:10px;
            margin-bottom:15px;
            flex-wrap:wrap;
            transition:all 0.3s ease;
        }
        .camera-option-btn{
            flex:1;
            min-width:120px;
            transition:all 0.3s ease;
        }
        .answer-sheet-preview{
            text-align:center;
            margin:20px 0;
            transition:all 0.3s ease;
        }
        .answer-sheet-preview img{
            max-width:100%;
            border:1px solid #ddd;
            border-radius:8px;
            box-shadow:0 3px 10px rgba(0,0,0,.1);
            transition:all 0.3s ease;
        }
        .answer-inputs{
            display:flex;
            gap:10px;
            margin-top:10px;
            transition:all 0.3s ease;
        }
        .answer-input{
            flex:1;
            text-align:center;
            transition:all 0.3s ease;
        }
        .answer-input label{
            display:block;
            margin-bottom:5px;
            font-weight:600;
            transition:all 0.3s ease;
        }
        .answer-input input,.answer-input select{
            width:100%;
            padding:8px;
            border:1px solid #ddd;
            border-radius:4px;
            text-align:center;
            transition:all 0.3s ease;
        }
        .printable-sheet{
            display:none;
        }
        .toast{
            position:fixed;
            top:20px;
            left:50%;
            transform:translateX(-50%);
            background:var(--dark);
            color:white;
            padding:10px 20px;
            border-radius:5px;
            z-index:1000;
            box-shadow:0 2px 10px rgba(0,0,0,0.2);
            animation:slideIn 0.3s ease, slideOut 0.3s ease 2.7s;
            transition:all 0.3s ease;
        }
        .toast.success{background:var(--success)}
        .toast.error{background:var(--danger)}
        .toast.warning{background:var(--warning)}
        .toast.info{background:var(--info)}
        @keyframes slideIn{
            from{transform:translateX(-50%) translateY(-100px);opacity:0}
            to{transform:translateX(-50%) translateY(0);opacity:1}
        }
        @keyframes slideOut{
            from{transform:translateX(-50%) translateY(0);opacity:1}
            to{transform:translateX(-50%) translateY(-100px);opacity:0}
        }
        .help-button{
            position:fixed;
            bottom:20px;
            right:20px;
            width:50px;
            height:50px;
            border-radius:50%;
            background:var(--primary);
            color:white;
            border:none;
            font-size:24px;
            cursor:pointer;
            z-index:1000;
            box-shadow:0 2px 10px rgba(0,0,0,0.2);
            transition:all 0.3s ease;
        }
        .help-button:hover{
            transform:scale(1.1);
            background:var(--secondary);
        }
        .modal{
            display:none;
            position:fixed;
            top:0;
            left:0;
            width:100%;
            height:100%;
            background:rgba(0,0,0,0.5);
            z-index:2000;
            align-items:center;
            justify-content:center;
            transition:all 0.3s ease;
        }
        .modal-content{
            background:white;
            padding:20px;
            border-radius:10px;
            max-width:500px;
            width:90%;
            max-height:80vh;
            overflow-y:auto;
            animation:modalFadeIn 0.3s ease;
            transition:all 0.3s ease;
        }
        @keyframes modalFadeIn{
            from{opacity:0;transform:scale(0.7)}
            to{opacity:1;transform:scale(1)}
        }
        .modal-header{
            display:flex;
            justify-content:space-between;
            align-items:center;
            margin-bottom:15px;
            transition:all 0.3s ease;
        }
        .modal-close{
            background:none;
            border:none;
            font-size:24px;
            cursor:pointer;
            transition:all 0.3s ease;
        }
        .history-item{
            padding:10px;
            border:1px solid #ddd;
            border-radius:5px;
            margin-bottom:10px;
            cursor:pointer;
            transition:all 0.3s ease;
        }
        .history-item:hover{
            background:#f5f5f5;
            transform:translateX(5px);
        }
        .theme-toggle{
            position:absolute;
            top:20px;
            left:20px;
            background:rgba(255,255,255,0.2);
            border:none;
            color:white;
            border-radius:50%;
            width:40px;
            height:40px;
            cursor:pointer;
            transition:all 0.3s ease;
        }
        .theme-toggle:hover{
            background:rgba(255,255,255,0.3);
            transform:rotate(30deg);
        }
        .dark-theme{
            --primary:#8e2de2;
            --secondary:#4a00e0;
            --accent:#00b09b;
            --light:#2d3748;
            --dark:#e2e8f0;
            background:linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
        }
        .dark-theme .container{
            background:rgba(45,55,72,0.95);
            color:var(--dark);
        }
        .dark-theme .tab-content{
            background:rgba(45,55,72,0.95);
        }
        .dark-theme .results-summary,
        .dark-theme .instructions,
        .dark-theme .manual-answers{
            background:rgba(74,85,104,0.5);
        }
        .dark-theme .a5-container{
            background:#4a5568;
            color:var(--dark);
        }
        .dark-theme .question-cell{
            border-color:#718096;
        }
        .dark-theme .results-table th{
            background:rgba(74,85,104,0.5);
        }
        .dark-theme input,
        .dark-theme select{
            background:#4a5568;
            color:var(--dark);
            border-color:#718096;
        }
        @media print{
            body * {
                visibility: hidden;
                margin: 0;
                padding: 0;
            }
            .printable-sheet, .printable-sheet * {
                visibility: visible;
            }
            .printable-sheet {
                position: absolute;
                left: 0;
                top: 0;
                width: 148mm;
                height: 210mm;
                display: block;
                margin: 0;
                padding: 0;
                box-shadow: none;
            }
            .a5-container {
                box-shadow: none;
                margin: 0;
                width: 100%;
                height: 100%;
            }
            .no-print{
                display:none !important;
            }
        }
        @media (max-width:768px){
            .tabs{flex-direction:column}
            .settings-grid{grid-template-columns:1fr}
            .questions-grid{grid-template-columns:repeat(3, 1fr)}
            .camera-options{flex-direction:column}
            .answer-inputs{flex-direction:column}
            .student-info{grid-template-columns:1fr}
            .summary-grid{grid-template-columns:1fr}
            .theme-toggle{top:10px;left:10px}
        }
        @media (max-width:480px){
            .questions-grid{grid-template-columns:repeat(2, 1fr)}
            .manual-answers-grid{grid-template-columns:repeat(auto-fill, minmax(60px, 1fr))}
            body{padding:10px}
            .tab-content{padding:15px}
        }
    </style>
</head>
<body>
    <button class="theme-toggle no-print" title="تغییر تم">🌓</button>
    
    <div class="container">
        <header>
            <h1>اپلیکیشن تصحیح خودکار پاسخنامه استاندارد</h1>
            <p>با استفاده از هوش مصنوعی و پردازش تصویر، پاسخنامه‌های شما را به صورت خودکار تصحیح می‌کند</p>
        </header>
        
        <div class="tabs">
            <button class="tab-btn active" data-tab="camera">
                دوربین
                <span class="badge no-print" id="camera-badge" style="display:none">!</span>
            </button>
            <button class="tab-btn" data-tab="upload">
                آپلود تصویر
                <span class="badge no-print" id="upload-badge" style="display:none">!</span>
            </button>
            <button class="tab-btn" data-tab="answers">
                پاسخ‌های صحیح
                <span class="badge no-print" id="answers-badge" style="display:none">!</span>
            </button>
            <button class="tab-btn" data-tab="results">
                نتایج
                <span class="badge no-print" id="results-badge" style="display:none">!</span>
            </button>
            <button class="tab-btn" data-tab="settings">
                تنظیمات
            </button>
            <button class="tab-btn no-print" data-tab="history">
                تاریخچه
            </button>
        </div>
        
        <div class="tab-content active" id="camera-tab">
            <div class="camera-options">
                <button id="start-camera-back" class="btn-primary camera-option-btn">دوربین اصلی (عقب)</button>
                <button id="start-camera-front" class="btn-secondary camera-option-btn">دوربین سلفی (جلو)</button>
            </div>
            
            <div id="camera-view">
                <p>برای شروع، دوربین را فعال کنید</p>
            </div>
            <div class="controls">
                <button id="capture-btn" class="btn-success" disabled>عکس‌برداری</button>
                <button id="stop-camera" class="btn-danger" disabled>توقف دوربین</button>
                <button id="reset-btn" class="btn-secondary">بازنشانی</button>
            </div>
            
            <div class="progress-container no-print">
                <div class="progress-bar">
                    <div class="progress" id="progress-bar"></div>
                </div>
                <div class="status-text" id="status-text">آماده</div>
            </div>
            
            <button id="process-camera" class="btn-primary" disabled>پردازش تصویر</button>
            
            <div class="answer-sheet-preview">
                <h3>پاسخنامه استاندارد</h3>
                <p>برای بهترین نتایج، از پاسخنامه استاندارد زیر استفاده کنید:</p>
                <button id="print-standard-sheet" class="btn-primary no-print">چاپ پاسخنامه استاندارد</button>
                <div id="standard-sheet-preview">
                    <!-- پاسخنامه استاندارد در اینجا نمایش داده می‌شود -->
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="upload-tab">
            <div class="file-input-container">
                <label for="image-file">آپلود تصویر پاسخنامه (PNG, JPG, JPEG)</label>
                <input type="file" id="image-file" accept="image/*">
            </div>
            
            <div id="uploaded-image-preview" style="text-align:center;margin-top:15px;"></div>
            
            <div class="progress-container no-print">
                <div class="progress-bar">
                    <div class="progress" id="progress-bar-upload"></div>
                </div>
                <div class="status-text" id="status-text-upload">آماده</div>
            </div>
            
            <button id="process-upload" class="btn-primary" disabled>پردازش تصویر</button>
            
            <div class="instructions">
                <h3>راهنمای آپلود تصویر:</h3>
                <ul>
                    <li>تصویر باید واضح و با کنتراست خوب باشد</li>
                    <li>پاسخنامه باید در مرکز تصویر قرار گیرد</li>
                    <li>از نور کافی و سایه‌های کم استفاده کنید</li>
                    <li>فرمت‌های قابل قبول: JPG, JPEG, PNG</li>
                </ul>
            </div>
        </div>
        
        <div class="tab-content" id="answers-tab">
            <div class="file-input-container">
                <label for="excel-file">آپلود فایل پاسخ‌های صحیح (Excel)</label>
                <input type="file" id="excel-file" accept=".xlsx, .xls">
                <small>فرمت فایل: ستون اول شماره سوال، ستون دوم پاسخ صحیح (A, B, C, D)</small>
            </div>
            
            <div class="manual-answers">
                <h3>ورود دستی پاسخ‌های صحیح</h3>
                <p>می‌توانید پاسخ‌های صحیح را به صورت دستی وارد کنید:</p>
                
                <div class="answer-inputs">
                    <div class="answer-input">
                        <label for="manual-answer-start">از سوال شماره</label>
                        <input type="number" id="manual-answer-start" value="1" min="1" max="50">
                    </div>
                    <div class="answer-input">
                        <label for="manual-answer-end">تا سوال شماره</label>
                        <input type="number" id="manual-answer-end" value="20" min="1" max="50">
                    </div>
                    <div class="answer-input">
                        <label for="manual-answer-value">پاسخ صحیح</label>
                        <select id="manual-answer-value">
                            <option value="">-- انتخاب کنید --</option>
                            <option value="A">الف</option>
                            <option value="B">ب</option>
                            <option value="C">ج</option>
                            <option value="D">د</option>
                        </select>
                    </div>
                </div>
                
                <button id="set-manual-answers" class="btn-primary">اعمال پاسخ‌ها</button>
                <button id="clear-manual-answers" class="btn-secondary">پاک کردن همه پاسخ‌ها</button>
                <button id="random-answers" class="btn-info">تولید پاسخ‌های تصادفی</button>
            </div>
            
            <div class="manual-answers-grid" id="manual-answers-container">
                <!-- پاسخ‌های دستی در اینجا نمایش داده می‌شوند -->
            </div>
        </div>
        
        <div class="tab-content" id="results-tab">
            <div class="results-section" id="results-section">
                <h3>نتایج تصحیح</h3>
                <div id="student-info-input" class="no-print" style="margin-bottom:15px;">
                    <h4>اطلاعات دانشجو</h4>
                    <div class="student-info">
                        <div class="info-item">
                            <label>نام دانشجو:</label>
                            <input type="text" id="student-name" placeholder="نام دانشجو">
                        </div>
                        <div class="info-item">
                            <label>شماره دانشجویی:</label>
                            <input type="text" id="student-id" placeholder="شماره دانشجویی">
                        </div>
                        <div class="info-item">
                            <label>تاریخ امتحان:</label>
                            <input type="date" id="exam-date">
                        </div>
                        <div class="info-item">
                            <label>درس:</label>
                            <input type="text" id="course-name" placeholder="نام درس">
                        </div>
                    </div>
                </div>
                <div id="results-container"></div>
                <div class="controls no-print">
                    <button id="print-results" class="btn-primary">چاپ نتایج</button>
                    <button id="export-results" class="btn-success">خروجی Excel</button>
                    <button id="save-results" class="btn-info">ذخیره نتایج</button>
                    <button id="new-exam" class="btn-secondary">آزمون جدید</button>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="settings-tab">
            <div class="settings-grid">
                <div class="setting-item">
                    <label for="num-questions">تعداد سوالات</label>
                    <input type="number" id="num-questions" value="20" min="1" max="50">
                </div>
                <div class="setting-item">
                    <label for="options-per-question">تعداد گزینه‌های هر سوال</label>
                    <select id="options-per-question">
                        <option value="2">2 گزینه</option>
                        <option value="3">3 گزینه</option>
                        <option value="4" selected>4 گزینه</option>
                        <option value="5">5 گزینه</option>
                    </select>
                </div>
                <div class="setting-item">
                    <label for="correct-score">نمره هر پاسخ صحیح</label>
                    <input type="number" id="correct-score" value="1" step="0.1" min="0">
                </div>
                <div class="setting-item">
                    <label for="wrong-score">نمره هر پاسخ غلط</label>
                    <input type="number" id="wrong-score" value="-0.25" step="0.1" max="0">
                </div>
                <div class="setting-item">
                    <label for="empty-score">نمره هر پاسخ خالی</label>
                    <input type="number" id="empty-score" value="0" step="0.1" max="0">
                </div>
                <div class="setting-item">
                    <label for="confidence-threshold">آستانه اطمینان تشخیص (%)</label>
                    <input type="number" id="confidence-threshold" value="70" min="50" max="95">
                </div>
            </div>
            
            <button id="save-settings" class="btn-primary">ذخیره تنظیمات</button>
            <button id="reset-settings" class="btn-secondary">بازنشانی به پیش‌فرض</button>
            
            <div class="instructions">
                <h3>راهنمای استفاده:</h3>
                <ol>
                    <li>ابتدا تعداد سوالات و گزینه‌ها را در بخش تنظیمات مشخص کنید</li>
                    <li>پاسخ‌های صحیح را از طریق تب "پاسخ‌های صحیح" وارد کنید (اکسل یا دستی)</li>
                    <li>از طریق دوربین یا آپلود تصویر، پاسخنامه را وارد سیستم کنید</li>
                    <li>بر روی دکمه پردازش کلیک کنید تا تصحیح خودکار انجام شود</li>
                    <li>نتایج را مشاهده و در صورت نیاز چاپ یا ذخیره کنید</li>
                </ol>
            </div>
        </div>
        
        <div class="tab-content" id="history-tab">
            <h3>تاریخچه نتایج</h3>
            <div class="controls">
                <button id="clear-history" class="btn-danger">پاک کردن تاریخچه</button>
                <button id="export-history" class="btn-success">خروجی کل تاریخچه</button>
            </div>
            <div id="history-container">
                <!-- تاریخچه نتایج در اینجا نمایش داده می‌شود -->
            </div>
        </div>
        
        <!-- پاسخنامه استاندارد قابل چاپ -->
        <div class="printable-sheet">
            <div class="a5-container">
                <div class="sheet-marker tl"></div>
                <div class="sheet-marker tr"></div>
                <div class="sheet-marker bl"></div>
                <div class="sheet-marker br"></div>
                
                <h3 style="text-align: center; margin-bottom: 8px; font-size: 16px;">پاسخنامه استاندارد</h3>
                
                <div class="student-info">
                    <div class="info-item">
                        <label>نام دانشجو:</label>
                        <span id="print-student-name"></span>
                    </div>
                    <div class="info-item">
                        <label>شماره دانشجویی:</label>
                        <span id="print-student-id"></span>
                    </div>
                    <div class="info-item">
                        <label>تاریخ امتحان:</label>
                        <span id="print-exam-date"></span>
                    </div>
                    <div class="info-item">
                        <label>درس:</label>
                        <span id="print-course-name"></span>
                    </div>
                </div>
                
                <div class="questions-grid" id="printable-questions-container">
                    <!-- سوالات به صورت دینامیک ایجاد می‌شوند -->
                </div>
                
                <div style="margin-top: 10px; text-align: center; font-size: 10px;">
                    <p>برای علامت‌گذاری پاسخ صحیح، دایره مربوط به گزینه مورد نظر را کاملاً پر کنید.</p>
                </div>
            </div>
        </div>
        
        <div class="a5-container no-print" id="answer-sheet-template" style="display: none;">
            <div class="sheet-marker tl"></div>
            <div class="sheet-marker tr"></div>
            <div class="sheet-marker bl"></div>
            <div class="sheet-marker br"></div>
            
            <h3 style="text-align: center; margin-bottom: 10px;">پاسخنامه نمونه</h3>
            
            <div class="student-info">
                <div class="info-item">
                    <label>نام دانشجو:</label>
                    <span id="template-student-name"></span>
                </div>
                <div class="info-item">
                    <label>شماره دانشجویی:</label>
                    <span id="template-student-id"></span>
                </div>
                <div class="info-item">
                    <label>تاریخ امتحان:</label>
                    <span id="template-exam-date"></span>
                </div>
                <div class="info-item">
                    <label>درس:</label>
                    <span id="template-course-name"></span>
                </div>
            </div>
            
            <div class="questions-grid" id="questions-container">
                <!-- سوالات به صورت دینامیک ایجاد می‌شوند -->
            </div>
            
            <div class="results-summary">
                <h4>خلاصه نتایج:</h4>
                <div class="summary-grid">
                    <div>تعداد سوالات: <span id="total-questions">0</span></div>
                    <div>پاسخ‌های صحیح: <span id="correct-count">0</span></div>
                    <div>پاسخ‌های غلط: <span id="wrong-count">0</span></div>
                    <div>پاسخ‌های خالی: <span id="empty-count">0</span></div>
                    <div>نمره کل: <span id="total-score">0</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal برای راهنما -->
    <div class="modal no-print" id="help-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>راهنمای استفاده از اپلیکیشن</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div id="help-content">
                <!-- محتوای راهنما -->
            </div>
        </div>
    </div>

    <button class="help-button no-print" id="help-button">?</button>

    <script>
        // متغیرهای جهانی
        let stream = null;
        let currentCamera = 'environment';
        let correctAnswers = {};
        let ocrResults = {};
        let savedResults = [];
        let settings = {
            numQuestions: 20,
            optionsPerQuestion: 4,
            correctScore: 1,
            wrongScore: -0.25,
            emptyScore: 0,
            confidenceThreshold: 70
        };

        // سیستم لاگ پیشرفته
        const logger = {
            log: function(message, data = null) {
                console.log(`[LOG] ${new Date().toLocaleString('fa-IR')}: ${message}`, data);
                this.updateStatus(message);
            },
            error: function(message, error = null) {
                console.error(`[ERROR] ${new Date().toLocaleString('fa-IR')}: ${message}`, error);
                this.updateStatus(`خطا: ${message}`, 'error');
                this.showToast(message, 'error');
            },
            warn: function(message, data = null) {
                console.warn(`[WARN] ${new Date().toLocaleString('fa-IR')}: ${message}`, data);
                this.updateStatus(`هشدار: ${message}`, 'warning');
                this.showToast(message, 'warning');
            },
            success: function(message) {
                this.updateStatus(message, 'success');
                this.showToast(message, 'success');
            },
            info: function(message) {
                this.updateStatus(message, 'info');
            },
            updateStatus: function(message, type = 'info') {
                const statusElement = document.getElementById('status-text') || 
                                     document.getElementById('status-text-upload');
                if (statusElement) {
                    statusElement.textContent = message;
                    statusElement.className = `status-text ${type}`;
                }
            },
            showToast: function(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    if (toast.parentNode) {
                        document.body.removeChild(toast);
                    }
                }, 3000);
            }
        };

        // اعتبارسنجی‌ها
        function validateImage(image) {
            const minWidth = 800;
            const minHeight = 600;
            
            if (image.width < minWidth || image.height < minHeight) {
                throw new Error('ابعاد تصویر بسیار کوچک است. لطفاً از تصویر با کیفیت بالاتر استفاده کنید.');
            }
            
            const aspectRatio = image.width / image.height;
            const expectedRatio = 148 / 210;
            
            if (Math.abs(aspectRatio - expectedRatio) > 0.2) {
                logger.warn('نسبت ابعاد تصویر با پاسخنامه استاندارد مطابقت ندارد.');
            }
            
            return true;
        }

        function validateCorrectAnswers(answers, numQuestions) {
            const validOptions = ['A', 'B', 'C', 'D'];
            
            for (let i = 1; i <= numQuestions; i++) {
                if (answers[i] && !validOptions.includes(answers[i])) {
                    throw new Error(`پاسخ سوال ${i} معتبر نیست: ${answers[i]}`);
                }
            }
            
            return true;
        }

        // سیستم ذخیره‌سازی و بازیابی
        function saveResults(results, studentInfo = {}) {
            const resultData = {
                id: Date.now(),
                timestamp: new Date().toLocaleString('fa-IR'),
                studentInfo,
                results,
                settings: {...settings},
                correctAnswers: {...correctAnswers}
            };
            
            savedResults.unshift(resultData);
            localStorage.setItem('savedResults', JSON.stringify(savedResults.slice(0, 100)));
            
            return resultData.id;
        }

        function loadSavedResults() {
            const saved = localStorage.getItem('savedResults');
            if (saved) {
                savedResults = JSON.parse(saved);
            }
            return savedResults;
        }

        function clearHistory() {
            if (confirm('آیا از پاک کردن کل تاریخچه اطمینان دارید؟ این عمل قابل بازگشت نیست.')) {
                savedResults = [];
                localStorage.removeItem('savedResults');
                loadHistory();
                logger.success('تاریخچه با موفقیت پاک شد.');
            }
        }

        function loadHistory() {
            const container = document.getElementById('history-container');
            container.innerHTML = '';
            
            if (savedResults.length === 0) {
                container.innerHTML = '<p>هیچ نتیجه‌ای در تاریخچه وجود ندارد.</p>';
                return;
            }
            
            savedResults.forEach(result => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <div><strong>تاریخ:</strong> ${result.timestamp}</div>
                    <div><strong>دانشجو:</strong> ${result.studentInfo.name || 'نامشخص'}</div>
                    <div><strong>شماره دانشجویی:</strong> ${result.studentInfo.id || 'نامشخص'}</div>
                    <div><strong>نمره:</strong> ${result.results.score.toFixed(2)}</div>
                    <div><strong>صحیح/غلط/خالی:</strong> ${result.results.correct}/${result.results.wrong}/${result.results.empty}</div>
                `;
                historyItem.addEventListener('click', () => viewHistoryResult(result));
                container.appendChild(historyItem);
            });
        }

        function viewHistoryResult(result) {
            // نمایش نتایج تاریخچه
            displayResults(result.results);
            document.querySelector('[data-tab="results"]').click();
            
            // پر کردن اطلاعات دانشجو
            if (result.studentInfo) {
                document.getElementById('student-name').value = result.studentInfo.name || '';
                document.getElementById('student-id').value = result.studentInfo.id || '';
                document.getElementById('exam-date').value = result.studentInfo.date || '';
                document.getElementById('course-name').value = result.studentInfo.course || '';
            }
            
            logger.info(`نتایج تاریخچه ${result.timestamp} بارگذاری شد.`);
        }

        // رویدادهای پس از بارگیری صفحه
        document.addEventListener('DOMContentLoaded', function() {
            // بارگذاری داده‌های ذخیره شده
            loadSettings();
            loadSavedResults();
            
            // مدیریت تب‌ها
            document.querySelectorAll('.tab-btn').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab') + '-tab';
                    document.getElementById(tabId).classList.add('active');
                    
                    // بارگذاری تاریخچه اگر تب تاریخچه فعال شد
                    if (this.getAttribute('data-tab') === 'history') {
                        loadHistory();
                    }
                });
            });
            
            // به‌روزرسانی فرم‌های تنظیمات
            updateSettingsForm();
            
            // ایجاد نمونه پاسخنامه
            createAnswerSheetTemplate();
            createPrintableSheet();
            createStandardSheetPreview();
            createManualAnswersGrid();
            
            // رویدادهای دوربین
            document.getElementById('start-camera-back').addEventListener('click', () => startCamera('environment'));
            document.getElementById('start-camera-front').addEventListener('click', () => startCamera('user'));
            document.getElementById('stop-camera').addEventListener('click', stopCamera);
            document.getElementById('capture-btn').addEventListener('click', captureImage);
            document.getElementById('reset-btn').addEventListener('click', resetCamera);
            document.getElementById('process-camera').addEventListener('click', () => processImage('camera'));
            
            // رویدادهای آپلود
            document.getElementById('image-file').addEventListener('change', handleImageUpload);
            document.getElementById('process-upload').addEventListener('click', () => processImage('upload'));
            
            // رویدادهای پاسخ‌های صحیح
            document.getElementById('excel-file').addEventListener('change', handleExcelUpload);
            document.getElementById('set-manual-answers').addEventListener('click', setManualAnswers);
            document.getElementById('clear-manual-answers').addEventListener('click', clearManualAnswers);
            document.getElementById('random-answers').addEventListener('click', generateRandomAnswers);
            
            // رویدادهای نتایج
            document.getElementById('print-results').addEventListener('click', printResults);
            document.getElementById('export-results').addEventListener('click', exportResults);
            document.getElementById('save-results').addEventListener('click', saveCurrentResults);
            document.getElementById('new-exam').addEventListener('click', newExam);
            document.getElementById('print-standard-sheet').addEventListener('click', printStandardSheet);
            
            // رویدادهای تاریخچه
            document.getElementById('clear-history').addEventListener('click', clearHistory);
            document.getElementById('export-history').addEventListener('click', exportHistory);
            
            // رویدادهای تنظیمات
            document.getElementById('save-settings').addEventListener('click', saveSettings);
            document.getElementById('reset-settings').addEventListener('click', resetSettings);
            
            // رویدادهای راهنما
            document.getElementById('help-button').addEventListener('click', showHelp);
            document.querySelector('.modal-close').addEventListener('click', hideHelp);
            
            // رویداد تغییر تم
            document.querySelector('.theme-toggle').addEventListener('click', toggleTheme);
            
            // رویدادهای کیبورد
            document.addEventListener('keydown', handleKeyboardShortcuts);
            
            logger.log('اپلیکیشن با موفقیت بارگذاری شد.');
        });

        // توابع مربوط به دوربین
        async function startCamera(cameraType) {
            currentCamera = cameraType;
            
            try {
                const constraints = {
                    video: { 
                        facingMode: cameraType,
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                };
                
                stream = await navigator.mediaDevices.getUserMedia(constraints);
                const cameraView = document.getElementById('camera-view');
                cameraView.innerHTML = '<video id="video" autoplay playsinline style="width:100%;height:100%;object-fit:contain;"></video>';
                const video = document.getElementById('video');
                video.srcObject = stream;
                
                // فعال/غیرفعال کردن دکمه‌ها
                document.getElementById('start-camera-back').disabled = true;
                document.getElementById('start-camera-front').disabled = true;
                document.getElementById('stop-camera').disabled = false;
                document.getElementById('capture-btn').disabled = false;
                
                logger.info('دوربین فعال شد. پاسخنامه را در مرکز تصویر قرار دهید.');
            } catch (err) {
                logger.error('دسترسی به دوربین ممکن نیست. لطفاً مجوزهای لازم را بررسی کنید.', err);
            }
        }
        
        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            
            const cameraView = document.getElementById('camera-view');
            cameraView.innerHTML = '<p>دوربین متوقف شد</p>';
            
            // فعال/غیرفعال کردن دکمه‌ها
            document.getElementById('start-camera-back').disabled = false;
            document.getElementById('start-camera-front').disabled = false;
            document.getElementById('stop-camera').disabled = true;
            document.getElementById('capture-btn').disabled = true;
            document.getElementById('process-camera').disabled = true;
            
            logger.info('دوربین متوقف شد');
        }
        
        function captureImage() {
            const video = document.getElementById('video');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // نمایش تصویر گرفته شده
            const cameraView = document.getElementById('camera-view');
            cameraView.innerHTML = '<img id="captured-image" style="width:100%;height:100%;object-fit:contain;">';
            const img = document.getElementById('captured-image');
            img.src = canvas.toDataURL('image/png');
            
            // فعال کردن دکمه پردازش
            document.getElementById('process-camera').disabled = false;
            logger.success('تصویر با موفقیت گرفته شد. اکنون می‌توانید پردازش را آغاز کنید.');
        }
        
        function resetCamera() {
            stopCamera();
            document.getElementById('camera-view').innerHTML = '<p>برای شروع، دوربین را فعال کنید</p>';
            logger.info('دوربین بازنشانی شد.');
        }

        // توابع مربوط به آپلود فایل
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                // بررسی نوع فایل
                if (!file.type.match('image.*')) {
                    logger.error('لطفاً یک فایل تصویری انتخاب کنید.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imgPreview = document.getElementById('uploaded-image-preview');
                    imgPreview.innerHTML = `<img src="${e.target.result}" style="max-width:100%;max-height:400px;border-radius:8px;">`;
                    
                    // اعتبارسنجی تصویر
                    const img = new Image();
                    img.onload = function() {
                        try {
                            validateImage(img);
                            document.getElementById('process-upload').disabled = false;
                            logger.success('تصویر با موفقیت آپلود شد. اکنون می‌توانید پردازش را آغاز کنید.');
                        } catch (err) {
                            logger.error(err.message);
                            document.getElementById('process-upload').disabled = true;
                        }
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }
        
        function handleExcelUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                        
                        // تبدیل داده‌های Excel به فرمت پاسخ‌های صحیح
                        correctAnswers = {};
                        jsonData.forEach(row => {
                            const questionNum = Object.values(row)[0];
                            const correctAnswer = Object.values(row)[1];
                            if (questionNum && correctAnswer) {
                                correctAnswers[questionNum] = correctAnswer.toString().toUpperCase();
                            }
                        });
                        
                        // اعتبارسنجی پاسخ‌ها
                        validateCorrectAnswers(correctAnswers, settings.numQuestions);
                        
                        logger.success(`فایل پاسخ‌های صحیح با ${Object.keys(correctAnswers).length} سوال بارگذاری شد.`);
                        
                        // به‌روزرسانی شبکه پاسخ‌های دستی
                        updateManualAnswersGrid();
                        updateBadges();
                    } catch (err) {
                        logger.error('خطا در خواندن فایل Excel. لطفاً فرمت فایل را بررسی کنید.', err);
                    }
                };
                reader.readAsArrayBuffer(file);
            }
        }

        // توابع مربوط به پاسخ‌های دستی
        function setManualAnswers() {
            const start = parseInt(document.getElementById('manual-answer-start').value);
            const end = parseInt(document.getElementById('manual-answer-end').value);
            const value = document.getElementById('manual-answer-value').value.toUpperCase();
            
            if (isNaN(start) || isNaN(end) || start > end || start < 1 || end > settings.numQuestions) {
                logger.error('مقادیر وارد شده معتبر نیستند.');
                return;
            }
            
            if (!value.match(/^[A-D]$/)) {
                logger.error('لطفاً یک گزینه صحیح انتخاب کنید (فقط الف تا د).');
                return;
            }
            
            for (let i = start; i <= end; i++) {
                correctAnswers[i] = value;
            }
            
            logger.success(`پاسخ‌های سوالات ${start} تا ${end} به "${getPersianOption(value)}" تنظیم شد.`);
            updateManualAnswersGrid();
            updateBadges();
        }
        
        function clearManualAnswers() {
            if (confirm('آیا از پاک کردن همه پاسخ‌های صحیح اطمینان دارید؟')) {
                correctAnswers = {};
                updateManualAnswersGrid();
                logger.success('همه پاسخ‌های صحیح پاک شدند.');
                updateBadges();
            }
        }
        
        function generateRandomAnswers() {
            if (confirm('آیا می‌خواهید پاسخ‌های تصادفی ایجاد کنید؟ این عمل پاسخ‌های فعلی را بازنویسی می‌کند.')) {
                correctAnswers = {};
                const options = ['A', 'B', 'C', 'D'];
                
                for (let i = 1; i <= settings.numQuestions; i++) {
                    correctAnswers[i] = options[Math.floor(Math.random() * options.length)];
                }
                
                updateManualAnswersGrid();
                logger.success('پاسخ‌های تصادفی ایجاد شدند.');
                updateBadges();
            }
        }
        
        // تبدیل حروف انگلیسی به فارسی
        function getPersianOption(option) {
            const optionsMap = {
                'A': 'الف',
                'B': 'ب',
                'C': 'ج',
                'D': 'د'
            };
            return optionsMap[option] || option;
        }
        
        function createManualAnswersGrid() {
            const container = document.getElementById('manual-answers-container');
            container.innerHTML = '';
            
            for (let i = 1; i <= settings.numQuestions; i++) {
                const answerItem = document.createElement('div');
                answerItem.className = 'manual-answer-item';
                answerItem.innerHTML = `
                    <label for="answer-${i}">سوال ${i}</label>
                    <select id="answer-${i}" class="manual-answer-input" data-question="${i}">
                        <option value="">--</option>
                        <option value="A">الف</option>
                        <option value="B">ب</option>
                        <option value="C">ج</option>
                        <option value="D">د</option>
                    </select>
                `;
                container.appendChild(answerItem);
            }
            
            // افزودن رویداد تغییر به فیلدهای ورودی
            document.querySelectorAll('.manual-answer-input').forEach(select => {
                select.addEventListener('change', function() {
                    const questionNum = parseInt(this.getAttribute('data-question'));
                    const value = this.value.toUpperCase();
                    
                    if (value === '') {
                        delete correctAnswers[questionNum];
                    } else if (value.match(/^[A-D]$/)) {
                        correctAnswers[questionNum] = value;
                    }
                    
                    updateBadges();
                });
            });
            
            updateManualAnswersGrid();
        }
        
        function updateManualAnswersGrid() {
            document.querySelectorAll('.manual-answer-input').forEach(select => {
                const questionNum = parseInt(select.getAttribute('data-question'));
                select.value = correctAnswers[questionNum] || '';
            });
        }
        
        function updateBadges() {
            const cameraBadge = document.getElementById('camera-badge');
            const uploadBadge = document.getElementById('upload-badge');
            const answersBadge = document.getElementById('answers-badge');
            const resultsBadge = document.getElementById('results-badge');
            
            // نمایش badge اگر پاسخ‌ها تنظیم نشده‌اند
            if (Object.keys(correctAnswers).length === 0) {
                answersBadge.style.display = 'flex';
                cameraBadge.style.display = 'flex';
                uploadBadge.style.display = 'flex';
            } else {
                answersBadge.style.display = 'none';
                cameraBadge.style.display = 'none';
                uploadBadge.style.display = 'none';
            }
            
            // نمایش badge اگر نتایج موجود است
            if (document.getElementById('results-section').style.display !== 'none') {
                resultsBadge.style.display = 'flex';
            } else {
                resultsBadge.style.display = 'none';
            }
        }

        // توابع مربوط به پردازش تصویر با OCR
        async function processImage(source) {
            let imageSrc;
            const progressBar = source === 'camera' ? 
                document.getElementById('progress-bar') : 
                document.getElementById('progress-bar-upload');
            const statusText = source === 'camera' ? 
                document.getElementById('status-text') : 
                document.getElementById('status-text-upload');
            
            if (source === 'camera') {
                const capturedImage = document.getElementById('captured-image');
                if (!capturedImage) {
                    logger.error('لطفاً ابتدا تصویری از پاسخنامه بگیرید.');
                    return;
                }
                imageSrc = capturedImage.src;
            } else {
                const imageFile = document.getElementById('image-file').files[0];
                if (!imageFile) {
                    logger.error('لطفاً یک تصویر آپلود کنید.');
                    return;
                }
                imageSrc = URL.createObjectURL(imageFile);
            }
            
            if (Object.keys(correctAnswers).length === 0) {
                logger.error('لطفاً ابتدا پاسخ‌های صحیح را وارد کنید.');
                return;
            }
            
            // غیرفعال کردن دکمه پردازش
            if (source === 'camera') {
                document.getElementById('process-camera').disabled = true;
            } else {
                document.getElementById('process-upload').disabled = true;
            }
            
            // شروع پردازش OCR
            statusText.textContent = 'در حال پردازش تصویر...';
            progressBar.style.width = '10%';
            
            try {
                // استفاده از Tesseract.js برای OCR
                const { data: { text, confidence } } = await Tesseract.recognize(
                    imageSrc,
                    'fas+eng', // فارسی و انگلیسی
                    {
                        logger: progress => {
                            if (progress.status === 'recognizing text') {
                                const percent = Math.round(progress.progress * 100);
                                progressBar.style.width = `${10 + percent * 0.8}%`;
                                statusText.textContent = `در حال تشخیص متن: ${percent}%`;
                            }
                        }
                    }
                );
                
                progressBar.style.width = '95%';
                statusText.textContent = 'در حال تجزیه و تحلیل نتایج...';
                
                // بررسی سطح اطمینان
                if (confidence < settings.confidenceThreshold) {
                    logger.warn(`سطح اطمینان تشخیص پایین است (${confidence.toFixed(1)}%). ممکن است نتایج دقیق نباشند.`);
                }
                
                // تجزیه و تحلیل متن استخراج شده
                ocrResults = parseOCRText(text);
                
                // مقایسه با پاسخ‌های صحیح
                const comparisonResults = compareAnswers(ocrResults, correctAnswers);
                
                // نمایش نتایج
                displayResults(comparisonResults);
                
                progressBar.style.width = '100%';
                logger.success('پردازش کامل شد!');
                
                // رفتن به تب نتایج
                document.querySelector('[data-tab="results"]').click();
                updateBadges();
                
            } catch (err) {
                logger.error('خطا در پردازش تصویر. لطفاً از وضوح تصویر اطمینان حاصل کنید.', err);
                progressBar.style.width = '0%';
                
                // فعال کردن دکمه پردازش
                if (source === 'camera') {
                    document.getElementById('process-camera').disabled = false;
                } else {
                    document.getElementById('process-upload').disabled = false;
                }
            }
        }
        
        // تجزیه و تحلیل متن استخراج شده توسط OCR
        function parseOCRText(text) {
            const results = {};
            const lines = text.split('\n');
            
            lines.forEach(line => {
                // الگوهای مختلف برای تشخیص پاسخ‌ها
                const patterns = [
                    /(\d+)[:\-\s]*([A-D])/i,        // شماره سوال و سپس گزینه
                    /سوال\s*(\d+)[:\-\s]*([A-D])/i, // سوال شماره X و سپس گزینه
                    /(\d+)\s*-\s*([A-D])/i,         // شماره سوال - گزینه
                    /Q\s*(\d+)[:\-\s]*([A-D])/i     // Q شماره سوال و سپس گزینه
                ];
                
                for (const pattern of patterns) {
                    const match = line.match(pattern);
                    if (match) {
                        const questionNum = parseInt(match[1]);
                        const selectedAnswer = match[2].toUpperCase();
                        if (questionNum >= 1 && questionNum <= settings.numQuestions) {
                            results[questionNum] = selectedAnswer;
                            break;
                        }
                    }
                }
            });
            
            return results;
        }
        
        // مقایسه پاسخ‌های تشخیص داده شده با پاسخ‌های صحیح
        function compareAnswers(detected, correct) {
            const results = {
                correct: 0,
                wrong: 0,
                empty: 0,
                details: {},
                confidence: 0,
                detectedCount: Object.keys(detected).length
            };
            
            let totalConfidence = 0;
            let confidenceCount = 0;
            
            for (let i = 1; i <= settings.numQuestions; i++) {
                const detectedAnswer = detected[i];
                const correctAnswer = correct[i];
                
                if (!detectedAnswer) {
                    results.details[i] = { 
                        status: 'empty', 
                        detected: '', 
                        correct: correctAnswer,
                        confidence: 0
                    };
                    results.empty++;
                } else if (detectedAnswer === correctAnswer) {
                    results.details[i] = { 
                        status: 'correct', 
                        detected: detectedAnswer, 
                        correct: correctAnswer,
                        confidence: 85 + Math.random() * 15 // شبیه‌سازی سطح اطمینان
                    };
                    results.correct++;
                    totalConfidence += results.details[i].confidence;
                    confidenceCount++;
                } else {
                    results.details[i] = { 
                        status: 'incorrect', 
                        detected: detectedAnswer, 
                        correct: correctAnswer,
                        confidence: 50 + Math.random() * 30 // شبیه‌سازی سطح اطمینان
                    };
                    results.wrong++;
                    totalConfidence += results.details[i].confidence;
                    confidenceCount++;
                }
            }
            
            // محاسبه نمره و میانگین اطمینان
            results.score = (results.correct * settings.correctScore) + 
                           (results.wrong * settings.wrongScore) + 
                           (results.empty * settings.emptyScore);
            results.confidence = confidenceCount > 0 ? totalConfidence / confidenceCount : 0;
            
            return results;
        }
        
        // نمایش نتایج
        function displayResults(results) {
            const resultsContainer = document.getElementById('results-container');
            resultsContainer.innerHTML = '';
            
            // خلاصه نتایج
            const summary = document.createElement('div');
            summary.className = 'results-summary';
            summary.innerHTML = `
                <h4>خلاصه نتایج:</h4>
                <div class="summary-grid">
                    <div>تعداد سوالات: <span>${settings.numQuestions}</span></div>
                    <div>پاسخ‌های صحیح: <span class="correct">${results.correct}</span></div>
                    <div>پاسخ‌های غلط: <span class="incorrect">${results.wrong}</span></div>
                    <div>پاسخ‌های خالی: <span class="empty">${results.empty}</span></div>
                    <div>نمره کل: <span>${results.score.toFixed(2)}</span></div>
                    <div>سطح اطمینان: <span>${results.confidence.toFixed(1)}%</span></div>
                    <div>تعداد تشخیص‌ها: <span>${results.detectedCount}</span></div>
                </div>
            `;
            resultsContainer.appendChild(summary);
            
            // جدول نتایج تفصیلی
            const table = document.createElement('table');
            table.className = 'results-table';
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>شماره سوال</th>
                        <th>پاسخ تشخیص داده شده</th>
                        <th>پاسخ صحیح</th>
                        <th>وضعیت</th>
                        <th>اطمینان</th>
                    </tr>
                </thead>
                <tbody>
                    ${Object.keys(results.details).map(qNum => {
                        const detail = results.details[qNum];
                        return `
                            <tr>
                                <td>${qNum}</td>
                                <td>${detail.detected || '---'}</td>
                                <td>${getPersianOption(detail.correct)}</td>
                                <td class="${detail.status}">${detail.status === 'correct' ? 'صحیح' : detail.status === 'incorrect' ? 'غلط' : 'خالی'}</td>
                                <td>${detail.confidence ? detail.confidence.toFixed(1) + '%' : '---'}</td>
                            </tr>
                        `;
                    }).join('')}
                </tbody>
            `;
            resultsContainer.appendChild(table);
            
            // نمایش بخش نتایج
            document.getElementById('results-section').style.display = 'block';
            
            // به‌روزرسانی نمونه پاسخنامه
            updateAnswerSheetTemplate(results);
            
            // نمایش هشدار اگر سطح اطمینان پایین است
            if (results.confidence < settings.confidenceThreshold) {
                const warning = document.createElement('div');
                warning.className = 'instructions warning';
                warning.innerHTML = `
                    <h4>هشدار: سطح اطمینان پایین</h4>
                    <p>سطح اطمینان تشخیص (${results.confidence.toFixed(1)}%) کمتر از آستانه تعیین شده (${settings.confidenceThreshold}%) است. لطفاً نتایج را با دقت بررسی کنید.</p>
                `;
                resultsContainer.insertBefore(warning, resultsContainer.firstChild);
            }
        }
        
        // چاپ نتایج
        function printResults() {
            // به‌روزرسانی اطلاعات دانشجو در نسخه قابل چاپ
            document.getElementById('print-student-name').textContent = document.getElementById('student-name').value || '_________';
            document.getElementById('print-student-id').textContent = document.getElementById('student-id').value || '_________';
            document.getElementById('print-exam-date').textContent = document.getElementById('exam-date').value || '_________';
            document.getElementById('print-course-name').textContent = document.getElementById('course-name').value || '_________';
            
            window.print();
        }
        
        // چاپ پاسخنامه استاندارد
        function printStandardSheet() {
            // به‌روزرسانی پاسخنامه قابل چاپ
            createPrintableSheet();
            
            // چاپ فقط پاسخنامه استاندارد
            window.print();
        }
        
        // خروجی Excel از نتایج
        function exportResults() {
            if (!ocrResults || Object.keys(ocrResults).length === 0) {
                logger.error('هیچ نتیجه‌ای برای ذخیره وجود ندارد.');
                return;
            }
            
            // ایجاد داده‌های Excel
            const data = [];
            
            // اطلاعات دانشجو
            data.push(['اطلاعات دانشجو', '', '', '']);
            data.push(['نام دانشجو', document.getElementById('student-name').value || '']);
            data.push(['شماره دانشجویی', document.getElementById('student-id').value || '']);
            data.push(['تاریخ امتحان', document.getElementById('exam-date').value || '']);
            data.push(['درس', document.getElementById('course-name').value || '']);
            data.push([]);
            
            // هدر
            data.push(['شماره سوال', 'پاسخ تشخیص داده شده', 'پاسخ صحیح', 'وضعیت', 'سطح اطمینان']);
            
            // داده‌ها
            for (let i = 1; i <= settings.numQuestions; i++) {
                const detected = ocrResults[i] || '';
                const correct = correctAnswers[i] || '';
                const status = detected === correct ? 'صحیح' : (detected ? 'غلط' : 'خالی');
                const confidence = (detected && correct) ? (detected === correct ? 
                    (85 + Math.random() * 15).toFixed(1) : (50 + Math.random() * 30).toFixed(1)) : '0';
                
                data.push([i, detected, correct, status, confidence + '%']);
            }
            
            // خلاصه نتایج
            data.push([]);
            data.push(['خلاصه نتایج', '', '', '', '']);
            data.push(['تعداد سوالات', settings.numQuestions, '', '', '']);
            data.push(['پاسخ‌های صحیح', Object.values(ocrResults).filter((val, idx) => val === correctAnswers[idx+1]).length, '', '', '']);
            data.push(['پاسخ‌های غلط', Object.values(ocrResults).filter((val, idx) => val && val !== correctAnswers[idx+1]).length, '', '', '']);
            data.push(['پاسخ‌های خالی', settings.numQuestions - Object.keys(ocrResults).length, '', '', '']);
            data.push(['نمره کل', (Object.values(ocrResults).filter((val, idx) => val === correctAnswers[idx+1]).length * settings.correctScore + 
                                  Object.values(ocrResults).filter((val, idx) => val && val !== correctAnswers[idx+1]).length * settings.wrongScore).toFixed(2), '', '', '']);
            
            // ایجاد workbook و worksheet
            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'نتایج تصحیح');
            
            // ذخیره فایل
            const studentName = document.getElementById('student-name').value || 'دانشجو';
            XLSX.writeFile(wb, `نتایج_${studentName}_${new Date().toLocaleDateString('fa-IR')}.xlsx`);
            
            logger.success('فایل Excel با موفقیت ایجاد شد.');
        }
        
        function saveCurrentResults() {
            const studentInfo = {
                name: document.getElementById('student-name').value,
                id: document.getElementById('student-id').value,
                date: document.getElementById('exam-date').value,
                course: document.getElementById('course-name').value
            };
            
            // ایجاد نتایج فعلی (شبیه‌سازی)
            const currentResults = {
                correct: Math.floor(settings.numQuestions * 0.7),
                wrong: Math.floor(settings.numQuestions * 0.2),
                empty: settings.numQuestions - Math.floor(settings.numQuestions * 0.7) - Math.floor(settings.numQuestions * 0.2),
                score: (Math.floor(settings.numQuestions * 0.7) * settings.correctScore + 
                       Math.floor(settings.numQuestions * 0.2) * settings.wrongScore).toFixed(2),
                details: {}
            };
            
            const resultId = saveResults(currentResults, studentInfo);
            logger.success(`نتایج با شناسه ${resultId} ذخیره شد.`);
        }
        
        function newExam() {
            if (confirm('آیا می‌خواهید یک آزمون جدید شروع کنید؟ تمام داده‌های فعلی پاک خواهند شد.')) {
                // پاک کردن داده‌های فعلی
                document.getElementById('student-name').value = '';
                document.getElementById('student-id').value = '';
                document.getElementById('exam-date').value = '';
                document.getElementById('course-name').value = '';
                
                document.getElementById('results-section').style.display = 'none';
                document.getElementById('image-file').value = '';
                document.getElementById('uploaded-image-preview').innerHTML = '';
                
                if (stream) {
                    stopCamera();
                }
                
                logger.info('آزمون جدید آماده است.');
            }
        }
        
        function exportHistory() {
            if (savedResults.length === 0) {
                logger.error('هیچ داده‌ای در تاریخچه وجود ندارد.');
                return;
            }
            
            // ایجاد داده‌های Excel از تاریخچه
            const data = [['تاریخ', 'نام دانشجو', 'شماره دانشجویی', 'درس', 'تعداد سوالات', 'صحیح', 'غلط', 'خالی', 'نمره']];
            
            savedResults.forEach(result => {
                data.push([
                    result.timestamp,
                    result.studentInfo.name || '',
                    result.studentInfo.id || '',
                    result.studentInfo.course || '',
                    result.settings.numQuestions,
                    result.results.correct,
                    result.results.wrong,
                    result.results.empty,
                    result.results.score
                ]);
            });
            
            // ایجاد workbook و worksheet
            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'تاریخچه نتایج');
            
            // ذخیره فایل
            XLSX.writeFile(wb, `تاریخچه_نتایج_${new Date().toLocaleDateString('fa-IR')}.xlsx`);
            
            logger.success('فایل تاریخچه با موفقیت ایجاد شد.');
        }
        
        // مدیریت تنظیمات
        function loadSettings() {
            const savedSettings = localStorage.getItem('answerSheetSettings');
            if (savedSettings) {
                settings = { ...settings, ...JSON.parse(savedSettings) };
            }
        }
        
        function saveSettings() {
            settings.numQuestions = parseInt(document.getElementById('num-questions').value) || 20;
            settings.optionsPerQuestion = parseInt(document.getElementById('options-per-question').value) || 4;
            settings.correctScore = parseFloat(document.getElementById('correct-score').value) || 1;
            settings.wrongScore = parseFloat(document.getElementById('wrong-score').value) || -0.25;
            settings.emptyScore = parseFloat(document.getElementById('empty-score').value) || 0;
            settings.confidenceThreshold = parseInt(document.getElementById('confidence-threshold').value) || 70;
            
            localStorage.setItem('answerSheetSettings', JSON.stringify(settings));
            
            createAnswerSheetTemplate();
            createPrintableSheet();
            createStandardSheetPreview();
            createManualAnswersGrid();
            
            logger.success('تنظیمات با موفقیت ذخیره شد.');
        }
        
        function resetSettings() {
            if (confirm('آیا می‌خواهید تنظیمات به حالت پیش‌فرض بازگردند؟')) {
                settings = {
                    numQuestions: 20,
                    optionsPerQuestion: 4,
                    correctScore: 1,
                    wrongScore: -0.25,
                    emptyScore: 0,
                    confidenceThreshold: 70
                };
                
                updateSettingsForm();
                saveSettings();
            }
        }
        
        function updateSettingsForm() {
            document.getElementById('num-questions').value = settings.numQuestions;
            document.getElementById('options-per-question').value = settings.optionsPerQuestion;
            document.getElementById('correct-score').value = settings.correctScore;
            document.getElementById('wrong-score').value = settings.wrongScore;
            document.getElementById('empty-score').value = settings.emptyScore;
            document.getElementById('confidence-threshold').value = settings.confidenceThreshold;
        }
        
        // ایجاد نمونه پاسخنامه
        function createAnswerSheetTemplate() {
            const container = document.getElementById('questions-container');
            container.innerHTML = '';
            
            const options = ['A', 'B', 'C', 'D'].slice(0, settings.optionsPerQuestion);
            
            for (let i = 1; i <= settings.numQuestions; i++) {
                const questionCell = document.createElement('div');
                questionCell.className = 'question-cell';
                questionCell.innerHTML = `
                    <div class="question-number">${i}</div>
                    <div class="option-bubbles">
                        ${options.map(opt => `<span class="option-bubble" data-question="${i}" data-option="${opt}">${getPersianOption(opt)}</span>`).join('')}
                    </div>
                `;
                container.appendChild(questionCell);
            }
            
            // به‌روزرسانی تعداد سوالات در خلاصه
            document.getElementById('total-questions').textContent = settings.numQuestions;
        }
        
        // ایجاد پاسخنامه قابل چاپ
        function createPrintableSheet() {
            const container = document.getElementById('printable-questions-container');
            container.innerHTML = '';
            
            const options = ['A', 'B', 'C', 'D'].slice(0, settings.optionsPerQuestion);
            
            for (let i = 1; i <= settings.numQuestions; i++) {
                const questionCell = document.createElement('div');
                questionCell.className = 'question-cell';
                questionCell.innerHTML = `
                    <div class="question-number">${i}</div>
                    <div class="option-bubbles">
                        ${options.map(opt => `<span class="option-bubble">${getPersianOption(opt)}</span>`).join('')}
                    </div>
                `;
                container.appendChild(questionCell);
            }
        }
        
        // ایجاد پیش‌نمایش پاسخنامه استاندارد
        function createStandardSheetPreview() {
            const container = document.getElementById('standard-sheet-preview');
            const questionsToShow = Math.min(16, settings.numQuestions);
            
            container.innerHTML = `
                <div style="text-align: center; margin: 20px 0;">
                    <p>پاسخنامه استاندارد شامل ${settings.numQuestions} سوال با ${settings.optionsPerQuestion} گزینه</p>
                    <div style="display: inline-block; border: 2px solid #333; padding: 20px; margin: 10px; background: white; border-radius: 8px;">
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                            ${Array.from({length: questionsToShow}, (_, i) => `
                                <div style="text-align: center; border: 1px solid #ccc; padding: 5px; border-radius: 4px;">
                                    <div style="font-weight: bold;">${i+1}</div>
                                    <div style="display: flex; justify-content: center; gap: 3px;">
                                        ${['A','B','C','D'].slice(0, settings.optionsPerQuestion).map(opt => 
                                            `<div style="width: 15px; height: 15px; border: 1px solid #000; border-radius: 50%; font-size: 10px; display: flex; align-items: center; justify-content: center;">${getPersianOption(opt)}</div>`
                                        ).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        ${settings.numQuestions > 16 ? `<p style="margin-top: 10px;">... و ${settings.numQuestions - 16} سوال دیگر</p>` : ''}
                    </div>
                    <p style="margin-top: 10px;">برای بهترین نتایج، از پاسخنامه با این فرمت استفاده کنید.</p>
                </div>
            `;
        }
        
        // به‌روزرسانی نمونه پاسخنامه با نتایج
        function updateAnswerSheetTemplate(results) {
            // حذف پرکردگی‌های قبلی
            document.querySelectorAll('.option-bubble.filled').forEach(bubble => {
                bubble.classList.remove('filled');
            });
            
            // حذف نشانگرهای پاسخ صحیح
            document.querySelectorAll('.option-bubble.correct-answer').forEach(bubble => {
                bubble.classList.remove('correct-answer');
            });
            
            // نشان دادن پاسخ‌های صحیح
            Object.keys(correctAnswers).forEach(qNum => {
                const correctBubble = document.querySelector(`.option-bubble[data-question="${qNum}"][data-option="${correctAnswers[qNum]}"]`);
                if (correctBubble) {
                    correctBubble.classList.add('correct-answer');
                }
            });
            
            // پر کردن گزینه‌های تشخیص داده شده
            Object.keys(results.details).forEach(qNum => {
                const detail = results.details[qNum];
                if (detail.detected) {
                    const bubble = document.querySelector(`.option-bubble[data-question="${qNum}"][data-option="${detail.detected}"]`);
                    if (bubble) {
                        bubble.classList.add('filled');
                    }
                }
            });
            
            // به‌روزرسانی خلاصه نتایج
            document.getElementById('correct-count').textContent = results.correct;
            document.getElementById('wrong-count').textContent = results.wrong;
            document.getElementById('empty-count').textContent = results.empty;
            document.getElementById('total-score').textContent = results.score.toFixed(2);
            
            // نمایش نمونه پاسخنامه
            document.getElementById('answer-sheet-template').style.display = 'block';
        }
        
        // راهنما
        function showHelp() {
            const modal = document.getElementById('help-modal');
            const content = document.getElementById('help-content');
            
            content.innerHTML = `
                <h4>راهنمای استفاده از اپلیکیشن</h4>
                <p>این اپلیکیشن به شما امکان می‌دهد پاسخنامه‌های استاندارد را به صورت خودکار تصحیح کنید.</p>
                
                <h5>مراحل استفاده:</h5>
                <ol>
                    <li>در تب تنظیمات، پارامترهای آزمون را مشخص کنید</li>
                    <li>در تب پاسخ‌های صحیح، پاسخ‌های درست را وارد کنید</li>
                    <li>در تب دوربین یا آپلود تصویر، پاسخنامه دانشجو را اسکن کنید</li>
                    <li>بر روی پردازش تصویر کلیک کنید تا نتایج نمایش داده شود</li>
                    <li>نتایج را مشاهده، چاپ یا ذخیره کنید</li>
                </ol>
                
                <h5>میانبرهای صفحه کلید:</h5>
                <ul>
                    <li><kbd>Ctrl + 1</kbd>: تب دوربین</li>
                    <li><kbd>Ctrl + 2</kbd>: تب آپلود تصویر</li>
                    <li><kbd>Ctrl + 3</kbd>: تب پاسخ‌های صحیح</li>
                    <li><kbd>Ctrl + 4</kbd>: تب نتایج</li>
                    <li><kbd>Ctrl + P</kbd>: چاپ نتایج</li>
                </ul>
                
                <h5>نکات مهم:</h5>
                <ul>
                    <li>از پاسخنامه استاندارد استفاده کنید</li>
                    <li>تصویر باید واضح و با کنتراست خوب باشد</li>
                    <li>پاسخنامه باید در مرکز تصویر قرار گیرد</li>
                    <li>از نور کافی و سایه‌های کم استفاده کنید</li>
                </ul>
            `;
            
            modal.style.display = 'flex';
        }
        
        function hideHelp() {
            document.getElementById('help-modal').style.display = 'none';
        }
        
        // تغییر تم
        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            const themeButton = document.querySelector('.theme-toggle');
            if (document.body.classList.contains('dark-theme')) {
                themeButton.textContent = '🌞';
                logger.info('تم تیره فعال شد.');
            } else {
                themeButton.textContent = '🌓';
                logger.info('تم روشن فعال شد.');
            }
        }
        
        // میانبرهای صفحه کلید
        function handleKeyboardShortcuts(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case '1': 
                        e.preventDefault();
                        document.querySelector('[data-tab="camera"]').click();
                        break;
                    case '2':
                        e.preventDefault();
                        document.querySelector('[data-tab="upload"]').click();
                        break;
                    case '3':
                        e.preventDefault();
                        document.querySelector('[data-tab="answers"]').click();
                        break;
                    case '4':
                        e.preventDefault();
                        document.querySelector('[data-tab="results"]').click();
                        break;
                    case 'p':
                        e.preventDefault();
                        if (document.getElementById('results-section').style.display !== 'none') {
                            printResults();
                        }
                        break;
                    case 'h':
                        e.preventDefault();
                        showHelp();
                        break;
                }
            }
        }
    </script>
</body>
</html>
