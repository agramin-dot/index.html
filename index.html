<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† ØªØµØ­ÛŒØ­ Ø®ÙˆØ¯Ú©Ø§Ø± Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
        :root{
            --primary:#4a00e0;
            --secondary:#8e2de2;
            --accent:#00b09b;
            --danger:#dc3545;
            --warning:#ffc107;
            --light:#f5f7fa;
            --dark:#333;
            --success:#28a745;
            --info:#17a2b8
        }
        body{
            background:linear-gradient(135deg,var(--primary) 0%,var(--secondary) 100%);
            color:var(--dark);
            min-height:100vh;
            padding:20px;
            transition:all 0.3s ease;
        }
        .container{
            max-width:1200px;
            margin:0 auto;
            background:rgba(255,255,255,.95);
            border-radius:15px;
            box-shadow:0 10px 30px rgba(0,0,0,.15);
            overflow:hidden;
            transition:all 0.3s ease;
        }
        header{
            background:linear-gradient(to right,var(--primary),var(--secondary));
            color:white;
            text-align:center;
            padding:25px 20px;
            position:relative;
            transition:all 0.3s ease;
        }
        header h1{
            font-size:1.8rem;
            margin-bottom:10px;
            transition:all 0.3s ease;
        }
        header p{
            font-size:1rem;
            opacity:.9;
            transition:all 0.3s ease;
        }
        .tabs{
            display:flex;
            background:var(--light);
            transition:all 0.3s ease;
        }
        .tab-btn{
            flex:1;
            padding:15px;
            border:none;
            cursor:pointer;
            font-weight:600;
            transition:all .3s ease;
            position:relative;
            overflow:hidden;
        }
        .tab-btn:hover{
            background:rgba(255,255,255,0.7);
        }
        .tab-btn.active{
            background:white;
            color:var(--primary);
            border-bottom:3px solid var(--primary);
        }
        .tab-btn .badge{
            position:absolute;
            top:5px;
            left:5px;
            background:var(--danger);
            color:white;
            border-radius:50%;
            width:18px;
            height:18px;
            font-size:10px;
            display:flex;
            align-items:center;
            justify-content:center;
        }
        .tab-content{
            display:none;
            padding:25px;
            animation:fadeIn 0.5s ease;
            transition:all 0.3s ease;
        }
        .tab-content.active{
            display:block;
        }
        @keyframes fadeIn{
            from{opacity:0;transform:translateY(10px)}
            to{opacity:1;transform:translateY(0)}
        }
        #camera-view{
            width:100%;
            height:400px;
            background:#000;
            position:relative;
            display:flex;
            justify-content:center;
            align-items:center;
            color:white;
            border-radius:8px;
            overflow:hidden;
            transition:all 0.3s ease;
        }
        .controls{
            display:flex;
            gap:10px;
            margin-top:10px;
            flex-wrap:wrap;
            transition:all 0.3s ease;
        }
        button{
            padding:10px 15px;
            border:none;
            border-radius:8px;
            cursor:pointer;
            font-weight:600;
            transition:all 0.3s ease;
            position:relative;
            overflow:hidden;
        }
        button:after{
            content:'';
            position:absolute;
            top:50%;
            left:50%;
            width:5px;
            height:5px;
            background:rgba(255,255,255,0.5);
            opacity:0;
            border-radius:100%;
            transform:scale(1,1) translate(-50%);
            transform-origin:50% 50%;
        }
        button:focus:not(:active)::after{
            animation:ripple 1s ease-out;
        }
        @keyframes ripple{
            0%{transform:scale(0,0);opacity:1;}
            100%{transform:scale(20,20);opacity:0;}
        }
        .btn-primary{background:var(--primary);color:white}
        .btn-primary:hover{background:#3a00c0;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.2)}
        .btn-success{background:var(--accent);color:white}
        .btn-success:hover{background:#00a08b;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.2)}
        .btn-danger{background:var(--danger);color:white}
        .btn-danger:hover{background:#c82333;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.2)}
        .btn-warning{background:var(--warning);color:var(--dark)}
        .btn-warning:hover{background:#e0a800;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.2)}
        .btn-secondary{background:#6c757d;color:white}
        .btn-secondary:hover{background:#5a6268;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.2)}
        .btn-info{background:var(--info);color:white}
        .btn-info:hover{background:#138496;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.2)}
        .results-section{
            background:#f0f9ff;
            padding:20px;
            border-radius:10px;
            margin-top:20px;
            display:none;
            animation:fadeIn 0.5s ease;
            transition:all 0.3s ease;
        }
        .answer-item{
            display:inline-block;
            margin:5px;
            padding:10px;
            border-radius:5px;
            font-weight:bold;
            min-width:40px;
            text-align:center;
            transition:all 0.3s ease;
        }
        .correct{background:#d4edda;color:#155724}
        .incorrect{background:#f8d7da;color:#721c24}
        .empty{background:#f8f9fa;color:#6c757d}
        .a5-container{
            width:148mm;
            height:210mm;
            padding:10mm;
            margin:20px auto;
            background:white;
            box-shadow:0 0 10px rgba(0,0,0,.1);
            position:relative;
            page-break-inside:avoid;
            box-sizing:border-box;
            transition:all 0.3s ease;
        }
        .sheet-marker{
            position:absolute;
            width:10px;
            height:10px;
            background:black;
            border:2px solid white;
            box-shadow:0 0 0 2px black;
            z-index:10;
            transition:all 0.3s ease;
        }
        .sheet-marker.tl{top:3mm;left:3mm}
        .sheet-marker.tr{top:3mm;right:3mm}
        .sheet-marker.bl{bottom:3mm;left:3mm}
        .sheet-marker.br{bottom:3mm;right:3mm}
        .student-info{
            display:grid;
            grid-template-columns:1fr 1fr;
            gap:3px;
            margin-bottom:8px;
            font-size:11px;
            transition:all 0.3s ease;
        }
        .info-item{
            display:flex;
            align-items:center;
            transition:all 0.3s ease;
        }
        .info-item label{
            width:80px;
            font-weight:bold;
            transition:all 0.3s ease;
        }
        .info-item span{
            flex:1;
            border-bottom:1px dashed #999;
            height:15px;
            transition:all 0.3s ease;
        }
        .questions-grid{
            display:grid;
            grid-template-columns:repeat(4, 1fr);
            gap:4px;
            margin-top:10px;
            transition:all 0.3s ease;
        }
        .question-cell{
            text-align:center;
            padding:3px;
            border:1px solid #ddd;
            border-radius:3px;
            font-size:10px;
            min-height:45px;
            display:flex;
            flex-direction:column;
            justify-content:space-between;
            transition:all 0.3s ease;
        }
        .question-number{
            font-weight:bold;
            margin-bottom:3px;
            font-size:11px;
            transition:all 0.3s ease;
        }
        .option-bubbles{
            display:flex;
            justify-content:center;
            gap:2px;
            transition:all 0.3s ease;
        }
        .option-bubble{
            width:14px;
            height:14px;
            border:1px solid #333;
            border-radius:50%;
            display:inline-flex;
            justify-content:center;
            align-items:center;
            font-size:9px;
            cursor:pointer;
            transition:all 0.3s ease;
        }
        .option-bubble:hover{
            transform:scale(1.1);
            box-shadow:0 0 5px rgba(0,0,0,0.3);
        }
        .option-bubble.filled::after{
            content:'';
            width:10px;
            height:10px;
            background:black;
            border-radius:50%;
            transition:all 0.3s ease;
        }
        .option-bubble.correct-answer{
            border-color:var(--success);
            box-shadow:0 0 0 1px var(--success);
        }
        .results-summary{
            margin-top:10px;
            padding:10px;
            border:1px solid #ddd;
            border-radius:4px;
            background:#f9f9f9;
            font-size:12px;
            transition:all 0.3s ease;
        }
        .summary-grid{
            display:grid;
            grid-template-columns:1fr 1fr;
            gap:5px;
            transition:all 0.3s ease;
        }
        .file-input-container{
            margin:15px 0;
            transition:all 0.3s ease;
        }
        .file-input-container label{
            display:block;
            margin-bottom:5px;
            font-weight:600;
            transition:all 0.3s ease;
        }
        .file-input-container input{
            width:100%;
            padding:8px;
            border:1px solid #ddd;
            border-radius:4px;
            transition:all 0.3s ease;
        }
        .file-input-container input:focus{
            border-color:var(--primary);
            box-shadow:0 0 0 2px rgba(74,0,224,0.2);
            outline:none;
        }
        .progress-container{
            margin:15px 0;
            transition:all 0.3s ease;
        }
        .progress-bar{
            width:100%;
            height:20px;
            background:#eee;
            border-radius:10px;
            overflow:hidden;
            transition:all 0.3s ease;
        }
        .progress{
            height:100%;
            background:var(--accent);
            width:0%;
            transition:width .3s ease;
        }
        .status-text{
            margin-top:5px;
            font-size:.9rem;
            text-align:center;
            transition:all 0.3s ease;
        }
        .status-text.error{color:var(--danger)}
        .status-text.warning{color:var(--warning)}
        .status-text.success{color:var(--success)}
        .status-text.info{color:var(--info)}
        .results-table{
            width:100%;
            border-collapse:collapse;
            margin-top:15px;
            transition:all 0.3s ease;
        }
        .results-table th,.results-table td{
            padding:10px;
            text-align:center;
            border:1px solid #ddd;
            transition:all 0.3s ease;
        }
        .results-table th{
            background:var(--light);
            transition:all 0.3s ease;
        }
        .results-table tr:hover{
            background-color:rgba(0,0,0,0.02);
        }
        .settings-grid{
            display:grid;
            grid-template-columns:1fr 1fr;
            gap:15px;
            transition:all 0.3s ease;
        }
        .setting-item{
            margin-bottom:15px;
            transition:all 0.3s ease;
        }
        .setting-item label{
            display:block;
            margin-bottom:5px;
            font-weight:600;
            transition:all 0.3s ease;
        }
        .setting-item input,.setting-item select{
            width:100%;
            padding:8px;
            border:1px solid #ddd;
            border-radius:4px;
            transition:all 0.3s ease;
        }
        .setting-item input:focus,.setting-item select:focus{
            border-color:var(--primary);
            box-shadow:0 0 0 2px rgba(74,0,224,0.2);
            outline:none;
        }
        .instructions{
            background:#f0f9ff;
            padding:15px;
            border-radius:8px;
            margin-top:20px;
            font-size:.9rem;
            transition:all 0.3s ease;
        }
        .instructions ol{
            padding-right:20px;
            margin-top:10px;
            transition:all 0.3s ease;
        }
        .instructions li{
            margin-bottom:5px;
            transition:all 0.3s ease;
        }
        .manual-answers{
            background:#f8f9fa;
            padding:15px;
            border-radius:8px;
            margin-top:15px;
            transition:all 0.3s ease;
        }
        .manual-answers-grid{
            display:grid;
            grid-template-columns:repeat(auto-fill, minmax(80px, 1fr));
            gap:10px;
            margin-top:10px;
            transition:all 0.3s ease;
        }
        .manual-answer-item{
            text-align:center;
            transition:all 0.3s ease;
        }
        .manual-answer-item select{
            width:100%;
            text-align:center;
            font-weight:bold;
            padding:5px;
            transition:all 0.3s ease;
        }
        .camera-options{
            display:flex;
            gap:10px;
            margin-bottom:15px;
            flex-wrap:wrap;
            transition:all 0.3s ease;
        }
        .camera-option-btn{
            flex:1;
            min-width:120px;
            transition:all 0.3s ease;
        }
        .answer-sheet-preview{
            text-align:center;
            margin:20px 0;
            transition:all 0.3s ease;
        }
        .answer-sheet-preview img{
            max-width:100%;
            border:1px solid #ddd;
            border-radius:8px;
            box-shadow:0 3px 10px rgba(0,0,0,.1);
            transition:all 0.3s ease;
        }
        .answer-inputs{
            display:flex;
            gap:10px;
            margin-top:10px;
            transition:all 0.3s ease;
        }
        .answer-input{
            flex:1;
            text-align:center;
            transition:all 0.3s ease;
        }
        .answer-input label{
            display:block;
            margin-bottom:5px;
            font-weight:600;
            transition:all 0.3s ease;
        }
        .answer-input input,.answer-input select{
            width:100%;
            padding:8px;
            border:1px solid #ddd;
            border-radius:4px;
            text-align:center;
            transition:all 0.3s ease;
        }
        .printable-sheet{
            display:none;
        }
        .toast{
            position:fixed;
            top:20px;
            left:50%;
            transform:translateX(-50%);
            background:var(--dark);
            color:white;
            padding:10px 20px;
            border-radius:5px;
            z-index:1000;
            box-shadow:0 2px 10px rgba(0,0,0,0.2);
            animation:slideIn 0.3s ease, slideOut 0.3s ease 2.7s;
            transition:all 0.3s ease;
        }
        .toast.success{background:var(--success)}
        .toast.error{background:var(--danger)}
        .toast.warning{background:var(--warning)}
        .toast.info{background:var(--info)}
        @keyframes slideIn{
            from{transform:translateX(-50%) translateY(-100px);opacity:0}
            to{transform:translateX(-50%) translateY(0);opacity:1}
        }
        @keyframes slideOut{
            from{transform:translateX(-50%) translateY(0);opacity:1}
            to{transform:translateX(-50%) translateY(-100px);opacity:0}
        }
        .help-button{
            position:fixed;
            bottom:20px;
            right:20px;
            width:50px;
            height:50px;
            border-radius:50%;
            background:var(--primary);
            color:white;
            border:none;
            font-size:24px;
            cursor:pointer;
            z-index:1000;
            box-shadow:0 2px 10px rgba(0,0,0,0.2);
            transition:all 0.3s ease;
        }
        .help-button:hover{
            transform:scale(1.1);
            background:var(--secondary);
        }
        .modal{
            display:none;
            position:fixed;
            top:0;
            left:0;
            width:100%;
            height:100%;
            background:rgba(0,0,0,0.5);
            z-index:2000;
            align-items:center;
            justify-content:center;
            transition:all 0.3s ease;
        }
        .modal-content{
            background:white;
            padding:20px;
            border-radius:10px;
            max-width:500px;
            width:90%;
            max-height:80vh;
            overflow-y:auto;
            animation:modalFadeIn 0.3s ease;
            transition:all 0.3s ease;
        }
        @keyframes modalFadeIn{
            from{opacity:0;transform:scale(0.7)}
            to{opacity:1;transform:scale(1)}
        }
        .modal-header{
            display:flex;
            justify-content:space-between;
            align-items:center;
            margin-bottom:15px;
            transition:all 0.3s ease;
        }
        .modal-close{
            background:none;
            border:none;
            font-size:24px;
            cursor:pointer;
            transition:all 0.3s ease;
        }
        .history-item{
            padding:10px;
            border:1px solid #ddd;
            border-radius:5px;
            margin-bottom:10px;
            cursor:pointer;
            transition:all 0.3s ease;
        }
        .history-item:hover{
            background:#f5f5f5;
            transform:translateX(5px);
        }
        .theme-toggle{
            position:absolute;
            top:20px;
            left:20px;
            background:rgba(255,255,255,0.2);
            border:none;
            color:white;
            border-radius:50%;
            width:40px;
            height:40px;
            cursor:pointer;
            transition:all 0.3s ease;
        }
        .theme-toggle:hover{
            background:rgba(255,255,255,0.3);
            transform:rotate(30deg);
        }
        .dark-theme{
            --primary:#8e2de2;
            --secondary:#4a00e0;
            --accent:#00b09b;
            --light:#2d3748;
            --dark:#e2e8f0;
            background:linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
        }
        .dark-theme .container{
            background:rgba(45,55,72,0.95);
            color:var(--dark);
        }
        .dark-theme .tab-content{
            background:rgba(45,55,72,0.95);
        }
        .dark-theme .results-summary,
        .dark-theme .instructions,
        .dark-theme .manual-answers{
            background:rgba(74,85,104,0.5);
        }
        .dark-theme .a5-container{
            background:#4a5568;
            color:var(--dark);
        }
        .dark-theme .question-cell{
            border-color:#718096;
        }
        .dark-theme .results-table th{
            background:rgba(74,85,104,0.5);
        }
        .dark-theme input,
        .dark-theme select{
            background:#4a5568;
            color:var(--dark);
            border-color:#718096;
        }
        @media print{
            body * {
                visibility: hidden;
                margin: 0;
                padding: 0;
            }
            .printable-sheet, .printable-sheet * {
                visibility: visible;
            }
            .printable-sheet {
                position: absolute;
                left: 0;
                top: 0;
                width: 148mm;
                height: 210mm;
                display: block;
                margin: 0;
                padding: 0;
                box-shadow: none;
            }
            .a5-container {
                box-shadow: none;
                margin: 0;
                width: 100%;
                height: 100%;
            }
            .no-print{
                display:none !important;
            }
        }
        @media (max-width:768px){
            .tabs{flex-direction:column}
            .settings-grid{grid-template-columns:1fr}
            .questions-grid{grid-template-columns:repeat(3, 1fr)}
            .camera-options{flex-direction:column}
            .answer-inputs{flex-direction:column}
            .student-info{grid-template-columns:1fr}
            .summary-grid{grid-template-columns:1fr}
            .theme-toggle{top:10px;left:10px}
        }
        @media (max-width:480px){
            .questions-grid{grid-template-columns:repeat(2, 1fr)}
            .manual-answers-grid{grid-template-columns:repeat(auto-fill, minmax(60px, 1fr))}
            body{padding:10px}
            .tab-content{padding:15px}
        }
    </style>
</head>
<body>
    <button class="theme-toggle no-print" title="ØªØºÛŒÛŒØ± ØªÙ…">ğŸŒ“</button>
    
    <div class="container">
        <header>
            <h1>Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† ØªØµØ­ÛŒØ­ Ø®ÙˆØ¯Ú©Ø§Ø± Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯</h1>
            <p>Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ùˆ Ù¾Ø±Ø¯Ø§Ø²Ø´ ØªØµÙˆÛŒØ±ØŒ Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§ Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± ØªØµØ­ÛŒØ­ Ù…ÛŒâ€ŒÚ©Ù†Ø¯</p>
        </header>
        
        <div class="tabs">
            <button class="tab-btn active" data-tab="camera">
                Ø¯ÙˆØ±Ø¨ÛŒÙ†
                <span class="badge no-print" id="camera-badge" style="display:none">!</span>
            </button>
            <button class="tab-btn" data-tab="upload">
                Ø¢Ù¾Ù„ÙˆØ¯ ØªØµÙˆÛŒØ±
                <span class="badge no-print" id="upload-badge" style="display:none">!</span>
            </button>
            <button class="tab-btn" data-tab="answers">
                Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØµØ­ÛŒØ­
                <span class="badge no-print" id="answers-badge" style="display:none">!</span>
            </button>
            <button class="tab-btn" data-tab="results">
                Ù†ØªØ§ÛŒØ¬
                <span class="badge no-print" id="results-badge" style="display:none">!</span>
            </button>
            <button class="tab-btn" data-tab="settings">
                ØªÙ†Ø¸ÛŒÙ…Ø§Øª
            </button>
            <button class="tab-btn no-print" data-tab="history">
                ØªØ§Ø±ÛŒØ®Ú†Ù‡
            </button>
        </div>
        
        <div class="tab-content active" id="camera-tab">
            <div class="camera-options">
                <button id="start-camera-back" class="btn-primary camera-option-btn">Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø§ØµÙ„ÛŒ (Ø¹Ù‚Ø¨)</button>
                <button id="start-camera-front" class="btn-secondary camera-option-btn">Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø³Ù„ÙÛŒ (Ø¬Ù„Ùˆ)</button>
            </div>
            
            <div id="camera-view">
                <p>Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ØŒ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯</p>
            </div>
            <div class="controls">
                <button id="capture-btn" class="btn-success" disabled>Ø¹Ú©Ø³â€ŒØ¨Ø±Ø¯Ø§Ø±ÛŒ</button>
                <button id="stop-camera" class="btn-danger" disabled>ØªÙˆÙ‚Ù Ø¯ÙˆØ±Ø¨ÛŒÙ†</button>
                <button id="reset-btn" class="btn-secondary">Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ</button>
            </div>
            
            <div class="progress-container no-print">
                <div class="progress-bar">
                    <div class="progress" id="progress-bar"></div>
                </div>
                <div class="status-text" id="status-text">Ø¢Ù…Ø§Ø¯Ù‡</div>
            </div>
            
            <button id="process-camera" class="btn-primary" disabled>Ù¾Ø±Ø¯Ø§Ø²Ø´ ØªØµÙˆÛŒØ±</button>
            
            <div class="answer-sheet-preview">
                <h3>Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯</h3>
                <p>Ø¨Ø±Ø§ÛŒ Ø¨Ù‡ØªØ±ÛŒÙ† Ù†ØªØ§ÛŒØ¬ØŒ Ø§Ø² Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ø²ÛŒØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯:</p>
                <button id="print-standard-sheet" class="btn-primary no-print">Ú†Ø§Ù¾ Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯</button>
                <div id="standard-sheet-preview">
                    <!-- Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="upload-tab">
            <div class="file-input-container">
                <label for="image-file">Ø¢Ù¾Ù„ÙˆØ¯ ØªØµÙˆÛŒØ± Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ (PNG, JPG, JPEG)</label>
                <input type="file" id="image-file" accept="image/*">
            </div>
            
            <div id="uploaded-image-preview" style="text-align:center;margin-top:15px;"></div>
            
            <div class="progress-container no-print">
                <div class="progress-bar">
                    <div class="progress" id="progress-bar-upload"></div>
                </div>
                <div class="status-text" id="status-text-upload">Ø¢Ù…Ø§Ø¯Ù‡</div>
            </div>
            
            <button id="process-upload" class="btn-primary" disabled>Ù¾Ø±Ø¯Ø§Ø²Ø´ ØªØµÙˆÛŒØ±</button>
            
            <div class="instructions">
                <h3>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¢Ù¾Ù„ÙˆØ¯ ØªØµÙˆÛŒØ±:</h3>
                <ul>
                    <li>ØªØµÙˆÛŒØ± Ø¨Ø§ÛŒØ¯ ÙˆØ§Ø¶Ø­ Ùˆ Ø¨Ø§ Ú©Ù†ØªØ±Ø§Ø³Øª Ø®ÙˆØ¨ Ø¨Ø§Ø´Ø¯</li>
                    <li>Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ Ø¨Ø§ÛŒØ¯ Ø¯Ø± Ù…Ø±Ú©Ø² ØªØµÙˆÛŒØ± Ù‚Ø±Ø§Ø± Ú¯ÛŒØ±Ø¯</li>
                    <li>Ø§Ø² Ù†ÙˆØ± Ú©Ø§ÙÛŒ Ùˆ Ø³Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ú©Ù… Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯</li>
                    <li>ÙØ±Ù…Øªâ€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ù‚Ø¨ÙˆÙ„: JPG, JPEG, PNG</li>
                </ul>
            </div>
        </div>
        
        <div class="tab-content" id="answers-tab">
            <div class="file-input-container">
                <label for="excel-file">Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØµØ­ÛŒØ­ (Excel)</label>
                <input type="file" id="excel-file" accept=".xlsx, .xls">
                <small>ÙØ±Ù…Øª ÙØ§ÛŒÙ„: Ø³ØªÙˆÙ† Ø§ÙˆÙ„ Ø´Ù…Ø§Ø±Ù‡ Ø³ÙˆØ§Ù„ØŒ Ø³ØªÙˆÙ† Ø¯ÙˆÙ… Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­ (A, B, C, D)</small>
            </div>
            
            <div class="manual-answers">
                <h3>ÙˆØ±ÙˆØ¯ Ø¯Ø³ØªÛŒ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØµØ­ÛŒØ­</h3>
                <p>Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØµØ­ÛŒØ­ Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯Ø³ØªÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:</p>
                
                <div class="answer-inputs">
                    <div class="answer-input">
                        <label for="manual-answer-start">Ø§Ø² Ø³ÙˆØ§Ù„ Ø´Ù…Ø§Ø±Ù‡</label>
                        <input type="number" id="manual-answer-start" value="1" min="1" max="50">
                    </div>
                    <div class="answer-input">
                        <label for="manual-answer-end">ØªØ§ Ø³ÙˆØ§Ù„ Ø´Ù…Ø§Ø±Ù‡</label>
                        <input type="number" id="manual-answer-end" value="20" min="1" max="50">
                    </div>
                    <div class="answer-input">
                        <label for="manual-answer-value">Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­</label>
                        <select id="manual-answer-value">
                            <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ --</option>
                            <option value="A">Ø§Ù„Ù</option>
                            <option value="B">Ø¨</option>
                            <option value="C">Ø¬</option>
                            <option value="D">Ø¯</option>
                        </select>
                    </div>
                </div>
                
                <button id="set-manual-answers" class="btn-primary">Ø§Ø¹Ù…Ø§Ù„ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§</button>
                <button id="clear-manual-answers" class="btn-secondary">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§</button>
                <button id="random-answers" class="btn-info">ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØªØµØ§Ø¯ÙÛŒ</button>
            </div>
            
            <div class="manual-answers-grid" id="manual-answers-container">
                <!-- Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÛŒ Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
            </div>
        </div>
        
        <div class="tab-content" id="results-tab">
            <div class="results-section" id="results-section">
                <h3>Ù†ØªØ§ÛŒØ¬ ØªØµØ­ÛŒØ­</h3>
                <div id="student-info-input" class="no-print" style="margin-bottom:15px;">
                    <h4>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø§Ù†Ø´Ø¬Ùˆ</h4>
                    <div class="student-info">
                        <div class="info-item">
                            <label>Ù†Ø§Ù… Ø¯Ø§Ù†Ø´Ø¬Ùˆ:</label>
                            <input type="text" id="student-name" placeholder="Ù†Ø§Ù… Ø¯Ø§Ù†Ø´Ø¬Ùˆ">
                        </div>
                        <div class="info-item">
                            <label>Ø´Ù…Ø§Ø±Ù‡ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒÛŒ:</label>
                            <input type="text" id="student-id" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒÛŒ">
                        </div>
                        <div class="info-item">
                            <label>ØªØ§Ø±ÛŒØ® Ø§Ù…ØªØ­Ø§Ù†:</label>
                            <input type="date" id="exam-date">
                        </div>
                        <div class="info-item">
                            <label>Ø¯Ø±Ø³:</label>
                            <input type="text" id="course-name" placeholder="Ù†Ø§Ù… Ø¯Ø±Ø³">
                        </div>
                    </div>
                </div>
                <div id="results-container"></div>
                <div class="controls no-print">
                    <button id="print-results" class="btn-primary">Ú†Ø§Ù¾ Ù†ØªØ§ÛŒØ¬</button>
                    <button id="export-results" class="btn-success">Ø®Ø±ÙˆØ¬ÛŒ Excel</button>
                    <button id="save-results" class="btn-info">Ø°Ø®ÛŒØ±Ù‡ Ù†ØªØ§ÛŒØ¬</button>
                    <button id="new-exam" class="btn-secondary">Ø¢Ø²Ù…ÙˆÙ† Ø¬Ø¯ÛŒØ¯</button>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="settings-tab">
            <div class="settings-grid">
                <div class="setting-item">
                    <label for="num-questions">ØªØ¹Ø¯Ø§Ø¯ Ø³ÙˆØ§Ù„Ø§Øª</label>
                    <input type="number" id="num-questions" value="20" min="1" max="50">
                </div>
                <div class="setting-item">
                    <label for="options-per-question">ØªØ¹Ø¯Ø§Ø¯ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù‡Ø± Ø³ÙˆØ§Ù„</label>
                    <select id="options-per-question">
                        <option value="2">2 Ú¯Ø²ÛŒÙ†Ù‡</option>
                        <option value="3">3 Ú¯Ø²ÛŒÙ†Ù‡</option>
                        <option value="4" selected>4 Ú¯Ø²ÛŒÙ†Ù‡</option>
                        <option value="5">5 Ú¯Ø²ÛŒÙ†Ù‡</option>
                    </select>
                </div>
                <div class="setting-item">
                    <label for="correct-score">Ù†Ù…Ø±Ù‡ Ù‡Ø± Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­</label>
                    <input type="number" id="correct-score" value="1" step="0.1" min="0">
                </div>
                <div class="setting-item">
                    <label for="wrong-score">Ù†Ù…Ø±Ù‡ Ù‡Ø± Ù¾Ø§Ø³Ø® ØºÙ„Ø·</label>
                    <input type="number" id="wrong-score" value="-0.25" step="0.1" max="0">
                </div>
                <div class="setting-item">
                    <label for="empty-score">Ù†Ù…Ø±Ù‡ Ù‡Ø± Ù¾Ø§Ø³Ø® Ø®Ø§Ù„ÛŒ</label>
                    <input type="number" id="empty-score" value="0" step="0.1" max="0">
                </div>
                <div class="setting-item">
                    <label for="confidence-threshold">Ø¢Ø³ØªØ§Ù†Ù‡ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† ØªØ´Ø®ÛŒØµ (%)</label>
                    <input type="number" id="confidence-threshold" value="70" min="50" max="95">
                </div>
            </div>
            
            <button id="save-settings" class="btn-primary">Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
            <button id="reset-settings" class="btn-secondary">Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø¨Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶</button>
            
            <div class="instructions">
                <h3>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡:</h3>
                <ol>
                    <li>Ø§Ø¨ØªØ¯Ø§ ØªØ¹Ø¯Ø§Ø¯ Ø³ÙˆØ§Ù„Ø§Øª Ùˆ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¯Ø± Ø¨Ø®Ø´ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯</li>
                    <li>Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØµØ­ÛŒØ­ Ø±Ø§ Ø§Ø² Ø·Ø±ÛŒÙ‚ ØªØ¨ "Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØµØ­ÛŒØ­" ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ø§Ú©Ø³Ù„ ÛŒØ§ Ø¯Ø³ØªÛŒ)</li>
                    <li>Ø§Ø² Ø·Ø±ÛŒÙ‚ Ø¯ÙˆØ±Ø¨ÛŒÙ† ÛŒØ§ Ø¢Ù¾Ù„ÙˆØ¯ ØªØµÙˆÛŒØ±ØŒ Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ø³ÛŒØ³ØªÙ… Ú©Ù†ÛŒØ¯</li>
                    <li>Ø¨Ø± Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ ØªØµØ­ÛŒØ­ Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ù†Ø¬Ø§Ù… Ø´ÙˆØ¯</li>
                    <li>Ù†ØªØ§ÛŒØ¬ Ø±Ø§ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ùˆ Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø² Ú†Ø§Ù¾ ÛŒØ§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯</li>
                </ol>
            </div>
        </div>
        
        <div class="tab-content" id="history-tab">
            <h3>ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù†ØªØ§ÛŒØ¬</h3>
            <div class="controls">
                <button id="clear-history" class="btn-danger">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªØ§Ø±ÛŒØ®Ú†Ù‡</button>
                <button id="export-history" class="btn-success">Ø®Ø±ÙˆØ¬ÛŒ Ú©Ù„ ØªØ§Ø±ÛŒØ®Ú†Ù‡</button>
            </div>
            <div id="history-container">
                <!-- ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù†ØªØ§ÛŒØ¬ Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
            </div>
        </div>
        
        <!-- Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ù‚Ø§Ø¨Ù„ Ú†Ø§Ù¾ -->
        <div class="printable-sheet">
            <div class="a5-container">
                <div class="sheet-marker tl"></div>
                <div class="sheet-marker tr"></div>
                <div class="sheet-marker bl"></div>
                <div class="sheet-marker br"></div>
                
                <h3 style="text-align: center; margin-bottom: 8px; font-size: 16px;">Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯</h3>
                
                <div class="student-info">
                    <div class="info-item">
                        <label>Ù†Ø§Ù… Ø¯Ø§Ù†Ø´Ø¬Ùˆ:</label>
                        <span id="print-student-name"></span>
                    </div>
                    <div class="info-item">
                        <label>Ø´Ù…Ø§Ø±Ù‡ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒÛŒ:</label>
                        <span id="print-student-id"></span>
                    </div>
                    <div class="info-item">
                        <label>ØªØ§Ø±ÛŒØ® Ø§Ù…ØªØ­Ø§Ù†:</label>
                        <span id="print-exam-date"></span>
                    </div>
                    <div class="info-item">
                        <label>Ø¯Ø±Ø³:</label>
                        <span id="print-course-name"></span>
                    </div>
                </div>
                
                <div class="questions-grid" id="printable-questions-container">
                    <!-- Ø³ÙˆØ§Ù„Ø§Øª Ø¨Ù‡ ØµÙˆØ±Øª Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ© Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                </div>
                
                <div style="margin-top: 10px; text-align: center; font-size: 10px;">
                    <p>Ø¨Ø±Ø§ÛŒ Ø¹Ù„Ø§Ù…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­ØŒ Ø¯Ø§ÛŒØ±Ù‡ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ú¯Ø²ÛŒÙ†Ù‡ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ú©Ø§Ù…Ù„Ø§Ù‹ Ù¾Ø± Ú©Ù†ÛŒØ¯.</p>
                </div>
            </div>
        </div>
        
        <div class="a5-container no-print" id="answer-sheet-template" style="display: none;">
            <div class="sheet-marker tl"></div>
            <div class="sheet-marker tr"></div>
            <div class="sheet-marker bl"></div>
            <div class="sheet-marker br"></div>
            
            <h3 style="text-align: center; margin-bottom: 10px;">Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ Ù†Ù…ÙˆÙ†Ù‡</h3>
            
            <div class="student-info">
                <div class="info-item">
                    <label>Ù†Ø§Ù… Ø¯Ø§Ù†Ø´Ø¬Ùˆ:</label>
                    <span id="template-student-name"></span>
                </div>
                <div class="info-item">
                    <label>Ø´Ù…Ø§Ø±Ù‡ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒÛŒ:</label>
                    <span id="template-student-id"></span>
                </div>
                <div class="info-item">
                    <label>ØªØ§Ø±ÛŒØ® Ø§Ù…ØªØ­Ø§Ù†:</label>
                    <span id="template-exam-date"></span>
                </div>
                <div class="info-item">
                    <label>Ø¯Ø±Ø³:</label>
                    <span id="template-course-name"></span>
                </div>
            </div>
            
            <div class="questions-grid" id="questions-container">
                <!-- Ø³ÙˆØ§Ù„Ø§Øª Ø¨Ù‡ ØµÙˆØ±Øª Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ© Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
            </div>
            
            <div class="results-summary">
                <h4>Ø®Ù„Ø§ØµÙ‡ Ù†ØªØ§ÛŒØ¬:</h4>
                <div class="summary-grid">
                    <div>ØªØ¹Ø¯Ø§Ø¯ Ø³ÙˆØ§Ù„Ø§Øª: <span id="total-questions">0</span></div>
                    <div>Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØµØ­ÛŒØ­: <span id="correct-count">0</span></div>
                    <div>Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØºÙ„Ø·: <span id="wrong-count">0</span></div>
                    <div>Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø®Ø§Ù„ÛŒ: <span id="empty-count">0</span></div>
                    <div>Ù†Ù…Ø±Ù‡ Ú©Ù„: <span id="total-score">0</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Ø¨Ø±Ø§ÛŒ Ø±Ø§Ù‡Ù†Ù…Ø§ -->
    <div class="modal no-print" id="help-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div id="help-content">
                <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø±Ø§Ù‡Ù†Ù…Ø§ -->
            </div>
        </div>
    </div>

    <button class="help-button no-print" id="help-button">?</button>

    <script>
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¬Ù‡Ø§Ù†ÛŒ
        let stream = null;
        let currentCamera = 'environment';
        let correctAnswers = {};
        let ocrResults = {};
        let savedResults = [];
        let settings = {
            numQuestions: 20,
            optionsPerQuestion: 4,
            correctScore: 1,
            wrongScore: -0.25,
            emptyScore: 0,
            confidenceThreshold: 70
        };

        // Ø³ÛŒØ³ØªÙ… Ù„Ø§Ú¯ Ù¾ÛŒØ´Ø±ÙØªÙ‡
        const logger = {
            log: function(message, data = null) {
                console.log(`[LOG] ${new Date().toLocaleString('fa-IR')}: ${message}`, data);
                this.updateStatus(message);
            },
            error: function(message, error = null) {
                console.error(`[ERROR] ${new Date().toLocaleString('fa-IR')}: ${message}`, error);
                this.updateStatus(`Ø®Ø·Ø§: ${message}`, 'error');
                this.showToast(message, 'error');
            },
            warn: function(message, data = null) {
                console.warn(`[WARN] ${new Date().toLocaleString('fa-IR')}: ${message}`, data);
                this.updateStatus(`Ù‡Ø´Ø¯Ø§Ø±: ${message}`, 'warning');
                this.showToast(message, 'warning');
            },
            success: function(message) {
                this.updateStatus(message, 'success');
                this.showToast(message, 'success');
            },
            info: function(message) {
                this.updateStatus(message, 'info');
            },
            updateStatus: function(message, type = 'info') {
                const statusElement = document.getElementById('status-text') || 
                                     document.getElementById('status-text-upload');
                if (statusElement) {
                    statusElement.textContent = message;
                    statusElement.className = `status-text ${type}`;
                }
            },
            showToast: function(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    if (toast.parentNode) {
                        document.body.removeChild(toast);
                    }
                }, 3000);
            }
        };

        // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒâ€ŒÙ‡Ø§
        function validateImage(image) {
            const minWidth = 800;
            const minHeight = 600;
            
            if (image.width < minWidth || image.height < minHeight) {
                throw new Error('Ø§Ø¨Ø¹Ø§Ø¯ ØªØµÙˆÛŒØ± Ø¨Ø³ÛŒØ§Ø± Ú©ÙˆÚ†Ú© Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø§Ø² ØªØµÙˆÛŒØ± Ø¨Ø§ Ú©ÛŒÙÛŒØª Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.');
            }
            
            const aspectRatio = image.width / image.height;
            const expectedRatio = 148 / 210;
            
            if (Math.abs(aspectRatio - expectedRatio) > 0.2) {
                logger.warn('Ù†Ø³Ø¨Øª Ø§Ø¨Ø¹Ø§Ø¯ ØªØµÙˆÛŒØ± Ø¨Ø§ Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ù…Ø·Ø§Ø¨Ù‚Øª Ù†Ø¯Ø§Ø±Ø¯.');
            }
            
            return true;
        }

        function validateCorrectAnswers(answers, numQuestions) {
            const validOptions = ['A', 'B', 'C', 'D'];
            
            for (let i = 1; i <= numQuestions; i++) {
                if (answers[i] && !validOptions.includes(answers[i])) {
                    throw new Error(`Ù¾Ø§Ø³Ø® Ø³ÙˆØ§Ù„ ${i} Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª: ${answers[i]}`);
                }
            }
            
            return true;
        }

        // Ø³ÛŒØ³ØªÙ… Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ
        function saveResults(results, studentInfo = {}) {
            const resultData = {
                id: Date.now(),
                timestamp: new Date().toLocaleString('fa-IR'),
                studentInfo,
                results,
                settings: {...settings},
                correctAnswers: {...correctAnswers}
            };
            
            savedResults.unshift(resultData);
            localStorage.setItem('savedResults', JSON.stringify(savedResults.slice(0, 100)));
            
            return resultData.id;
        }

        function loadSavedResults() {
            const saved = localStorage.getItem('savedResults');
            if (saved) {
                savedResults = JSON.parse(saved);
            }
            return savedResults;
        }

        function clearHistory() {
            if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú©Ù„ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª.')) {
                savedResults = [];
                localStorage.removeItem('savedResults');
                loadHistory();
                logger.success('ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù¾Ø§Ú© Ø´Ø¯.');
            }
        }

        function loadHistory() {
            const container = document.getElementById('history-container');
            container.innerHTML = '';
            
            if (savedResults.length === 0) {
                container.innerHTML = '<p>Ù‡ÛŒÚ† Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ Ø¯Ø± ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>';
                return;
            }
            
            savedResults.forEach(result => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <div><strong>ØªØ§Ø±ÛŒØ®:</strong> ${result.timestamp}</div>
                    <div><strong>Ø¯Ø§Ù†Ø´Ø¬Ùˆ:</strong> ${result.studentInfo.name || 'Ù†Ø§Ù…Ø´Ø®Øµ'}</div>
                    <div><strong>Ø´Ù…Ø§Ø±Ù‡ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒÛŒ:</strong> ${result.studentInfo.id || 'Ù†Ø§Ù…Ø´Ø®Øµ'}</div>
                    <div><strong>Ù†Ù…Ø±Ù‡:</strong> ${result.results.score.toFixed(2)}</div>
                    <div><strong>ØµØ­ÛŒØ­/ØºÙ„Ø·/Ø®Ø§Ù„ÛŒ:</strong> ${result.results.correct}/${result.results.wrong}/${result.results.empty}</div>
                `;
                historyItem.addEventListener('click', () => viewHistoryResult(result));
                container.appendChild(historyItem);
            });
        }

        function viewHistoryResult(result) {
            // Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬ ØªØ§Ø±ÛŒØ®Ú†Ù‡
            displayResults(result.results);
            document.querySelector('[data-tab="results"]').click();
            
            // Ù¾Ø± Ú©Ø±Ø¯Ù† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø§Ù†Ø´Ø¬Ùˆ
            if (result.studentInfo) {
                document.getElementById('student-name').value = result.studentInfo.name || '';
                document.getElementById('student-id').value = result.studentInfo.id || '';
                document.getElementById('exam-date').value = result.studentInfo.date || '';
                document.getElementById('course-name').value = result.studentInfo.course || '';
            }
            
            logger.info(`Ù†ØªØ§ÛŒØ¬ ØªØ§Ø±ÛŒØ®Ú†Ù‡ ${result.timestamp} Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯.`);
        }

        // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ù¾Ø³ Ø§Ø² Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ ØµÙØ­Ù‡
        document.addEventListener('DOMContentLoaded', function() {
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡
            loadSettings();
            loadSavedResults();
            
            // Ù…Ø¯ÛŒØ±ÛŒØª ØªØ¨â€ŒÙ‡Ø§
            document.querySelectorAll('.tab-btn').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab') + '-tab';
                    document.getElementById(tabId).classList.add('active');
                    
                    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø§Ú¯Ø± ØªØ¨ ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÙØ¹Ø§Ù„ Ø´Ø¯
                    if (this.getAttribute('data-tab') === 'history') {
                        loadHistory();
                    }
                });
            });
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙØ±Ù…â€ŒÙ‡Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
            updateSettingsForm();
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù…ÙˆÙ†Ù‡ Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡
            createAnswerSheetTemplate();
            createPrintableSheet();
            createStandardSheetPreview();
            createManualAnswersGrid();
            
            // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø¯ÙˆØ±Ø¨ÛŒÙ†
            document.getElementById('start-camera-back').addEventListener('click', () => startCamera('environment'));
            document.getElementById('start-camera-front').addEventListener('click', () => startCamera('user'));
            document.getElementById('stop-camera').addEventListener('click', stopCamera);
            document.getElementById('capture-btn').addEventListener('click', captureImage);
            document.getElementById('reset-btn').addEventListener('click', resetCamera);
            document.getElementById('process-camera').addEventListener('click', () => processImage('camera'));
            
            // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø¢Ù¾Ù„ÙˆØ¯
            document.getElementById('image-file').addEventListener('change', handleImageUpload);
            document.getElementById('process-upload').addEventListener('click', () => processImage('upload'));
            
            // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØµØ­ÛŒØ­
            document.getElementById('excel-file').addEventListener('change', handleExcelUpload);
            document.getElementById('set-manual-answers').addEventListener('click', setManualAnswers);
            document.getElementById('clear-manual-answers').addEventListener('click', clearManualAnswers);
            document.getElementById('random-answers').addEventListener('click', generateRandomAnswers);
            
            // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ù†ØªØ§ÛŒØ¬
            document.getElementById('print-results').addEventListener('click', printResults);
            document.getElementById('export-results').addEventListener('click', exportResults);
            document.getElementById('save-results').addEventListener('click', saveCurrentResults);
            document.getElementById('new-exam').addEventListener('click', newExam);
            document.getElementById('print-standard-sheet').addEventListener('click', printStandardSheet);
            
            // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡
            document.getElementById('clear-history').addEventListener('click', clearHistory);
            document.getElementById('export-history').addEventListener('click', exportHistory);
            
            // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
            document.getElementById('save-settings').addEventListener('click', saveSettings);
            document.getElementById('reset-settings').addEventListener('click', resetSettings);
            
            // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø±Ø§Ù‡Ù†Ù…Ø§
            document.getElementById('help-button').addEventListener('click', showHelp);
            document.querySelector('.modal-close').addEventListener('click', hideHelp);
            
            // Ø±ÙˆÛŒØ¯Ø§Ø¯ ØªØºÛŒÛŒØ± ØªÙ…
            document.querySelector('.theme-toggle').addEventListener('click', toggleTheme);
            
            // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ú©ÛŒØ¨ÙˆØ±Ø¯
            document.addEventListener('keydown', handleKeyboardShortcuts);
            
            logger.log('Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯.');
        });

        // ØªÙˆØ§Ø¨Ø¹ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø¯ÙˆØ±Ø¨ÛŒÙ†
        async function startCamera(cameraType) {
            currentCamera = cameraType;
            
            try {
                const constraints = {
                    video: { 
                        facingMode: cameraType,
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                };
                
                stream = await navigator.mediaDevices.getUserMedia(constraints);
                const cameraView = document.getElementById('camera-view');
                cameraView.innerHTML = '<video id="video" autoplay playsinline style="width:100%;height:100%;object-fit:contain;"></video>';
                const video = document.getElementById('video');
                video.srcObject = stream;
                
                // ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
                document.getElementById('start-camera-back').disabled = true;
                document.getElementById('start-camera-front').disabled = true;
                document.getElementById('stop-camera').disabled = false;
                document.getElementById('capture-btn').disabled = false;
                
                logger.info('Ø¯ÙˆØ±Ø¨ÛŒÙ† ÙØ¹Ø§Ù„ Ø´Ø¯. Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ Ø±Ø§ Ø¯Ø± Ù…Ø±Ú©Ø² ØªØµÙˆÛŒØ± Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯.');
            } catch (err) {
                logger.error('Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ù…Ù…Ú©Ù† Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§Ù‹ Ù…Ø¬ÙˆØ²Ù‡Ø§ÛŒ Ù„Ø§Ø²Ù… Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.', err);
            }
        }
        
        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            
            const cameraView = document.getElementById('camera-view');
            cameraView.innerHTML = '<p>Ø¯ÙˆØ±Ø¨ÛŒÙ† Ù…ØªÙˆÙ‚Ù Ø´Ø¯</p>';
            
            // ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
            document.getElementById('start-camera-back').disabled = false;
            document.getElementById('start-camera-front').disabled = false;
            document.getElementById('stop-camera').disabled = true;
            document.getElementById('capture-btn').disabled = true;
            document.getElementById('process-camera').disabled = true;
            
            logger.info('Ø¯ÙˆØ±Ø¨ÛŒÙ† Ù…ØªÙˆÙ‚Ù Ø´Ø¯');
        }
        
        function captureImage() {
            const video = document.getElementById('video');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Ù†Ù…Ø§ÛŒØ´ ØªØµÙˆÛŒØ± Ú¯Ø±ÙØªÙ‡ Ø´Ø¯Ù‡
            const cameraView = document.getElementById('camera-view');
            cameraView.innerHTML = '<img id="captured-image" style="width:100%;height:100%;object-fit:contain;">';
            const img = document.getElementById('captured-image');
            img.src = canvas.toDataURL('image/png');
            
            // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ù¾Ø±Ø¯Ø§Ø²Ø´
            document.getElementById('process-camera').disabled = false;
            logger.success('ØªØµÙˆÛŒØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú¯Ø±ÙØªÙ‡ Ø´Ø¯. Ø§Ú©Ù†ÙˆÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø±Ø§ Ø¢ØºØ§Ø² Ú©Ù†ÛŒØ¯.');
        }
        
        function resetCamera() {
            stopCamera();
            document.getElementById('camera-view').innerHTML = '<p>Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ØŒ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯</p>';
            logger.info('Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø´Ø¯.');
        }

        // ØªÙˆØ§Ø¨Ø¹ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                // Ø¨Ø±Ø±Ø³ÛŒ Ù†ÙˆØ¹ ÙØ§ÛŒÙ„
                if (!file.type.match('image.*')) {
                    logger.error('Ù„Ø·ÙØ§Ù‹ ÛŒÚ© ÙØ§ÛŒÙ„ ØªØµÙˆÛŒØ±ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imgPreview = document.getElementById('uploaded-image-preview');
                    imgPreview.innerHTML = `<img src="${e.target.result}" style="max-width:100%;max-height:400px;border-radius:8px;">`;
                    
                    // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ØªØµÙˆÛŒØ±
                    const img = new Image();
                    img.onload = function() {
                        try {
                            validateImage(img);
                            document.getElementById('process-upload').disabled = false;
                            logger.success('ØªØµÙˆÛŒØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯. Ø§Ú©Ù†ÙˆÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø±Ø§ Ø¢ØºØ§Ø² Ú©Ù†ÛŒØ¯.');
                        } catch (err) {
                            logger.error(err.message);
                            document.getElementById('process-upload').disabled = true;
                        }
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }
        
        function handleExcelUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                        
                        // ØªØ¨Ø¯ÛŒÙ„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Excel Ø¨Ù‡ ÙØ±Ù…Øª Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØµØ­ÛŒØ­
                        correctAnswers = {};
                        jsonData.forEach(row => {
                            const questionNum = Object.values(row)[0];
                            const correctAnswer = Object.values(row)[1];
                            if (questionNum && correctAnswer) {
                                correctAnswers[questionNum] = correctAnswer.toString().toUpperCase();
                            }
                        });
                        
                        // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§
                        validateCorrectAnswers(correctAnswers, settings.numQuestions);
                        
                        logger.success(`ÙØ§ÛŒÙ„ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØµØ­ÛŒØ­ Ø¨Ø§ ${Object.keys(correctAnswers).length} Ø³ÙˆØ§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯.`);
                        
                        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¨Ú©Ù‡ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÛŒ
                        updateManualAnswersGrid();
                        updateBadges();
                    } catch (err) {
                        logger.error('Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„ Excel. Ù„Ø·ÙØ§Ù‹ ÙØ±Ù…Øª ÙØ§ÛŒÙ„ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.', err);
                    }
                };
                reader.readAsArrayBuffer(file);
            }
        }

        // ØªÙˆØ§Ø¨Ø¹ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÛŒ
        function setManualAnswers() {
            const start = parseInt(document.getElementById('manual-answer-start').value);
            const end = parseInt(document.getElementById('manual-answer-end').value);
            const value = document.getElementById('manual-answer-value').value.toUpperCase();
            
            if (isNaN(start) || isNaN(end) || start > end || start < 1 || end > settings.numQuestions) {
                logger.error('Ù…Ù‚Ø§Ø¯ÛŒØ± ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³ØªÙ†Ø¯.');
                return;
            }
            
            if (!value.match(/^[A-D]$/)) {
                logger.error('Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ú¯Ø²ÛŒÙ†Ù‡ ØµØ­ÛŒØ­ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ (ÙÙ‚Ø· Ø§Ù„Ù ØªØ§ Ø¯).');
                return;
            }
            
            for (let i = start; i <= end; i++) {
                correctAnswers[i] = value;
            }
            
            logger.success(`Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø³ÙˆØ§Ù„Ø§Øª ${start} ØªØ§ ${end} Ø¨Ù‡ "${getPersianOption(value)}" ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯.`);
            updateManualAnswersGrid();
            updateBadges();
        }
        
        function clearManualAnswers() {
            if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØµØ­ÛŒØ­ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) {
                correctAnswers = {};
                updateManualAnswersGrid();
                logger.success('Ù‡Ù…Ù‡ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØµØ­ÛŒØ­ Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯.');
                updateBadges();
            }
        }
        
        function generateRandomAnswers() {
            if (confirm('Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØªØµØ§Ø¯ÙÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø±Ø§ Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.')) {
                correctAnswers = {};
                const options = ['A', 'B', 'C', 'D'];
                
                for (let i = 1; i <= settings.numQuestions; i++) {
                    correctAnswers[i] = options[Math.floor(Math.random() * options.length)];
                }
                
                updateManualAnswersGrid();
                logger.success('Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØªØµØ§Ø¯ÙÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù†Ø¯.');
                updateBadges();
            }
        }
        
        // ØªØ¨Ø¯ÛŒÙ„ Ø­Ø±ÙˆÙ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ
        function getPersianOption(option) {
            const optionsMap = {
                'A': 'Ø§Ù„Ù',
                'B': 'Ø¨',
                'C': 'Ø¬',
                'D': 'Ø¯'
            };
            return optionsMap[option] || option;
        }
        
        function createManualAnswersGrid() {
            const container = document.getElementById('manual-answers-container');
            container.innerHTML = '';
            
            for (let i = 1; i <= settings.numQuestions; i++) {
                const answerItem = document.createElement('div');
                answerItem.className = 'manual-answer-item';
                answerItem.innerHTML = `
                    <label for="answer-${i}">Ø³ÙˆØ§Ù„ ${i}</label>
                    <select id="answer-${i}" class="manual-answer-input" data-question="${i}">
                        <option value="">--</option>
                        <option value="A">Ø§Ù„Ù</option>
                        <option value="B">Ø¨</option>
                        <option value="C">Ø¬</option>
                        <option value="D">Ø¯</option>
                    </select>
                `;
                container.appendChild(answerItem);
            }
            
            // Ø§ÙØ²ÙˆØ¯Ù† Ø±ÙˆÛŒØ¯Ø§Ø¯ ØªØºÛŒÛŒØ± Ø¨Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ
            document.querySelectorAll('.manual-answer-input').forEach(select => {
                select.addEventListener('change', function() {
                    const questionNum = parseInt(this.getAttribute('data-question'));
                    const value = this.value.toUpperCase();
                    
                    if (value === '') {
                        delete correctAnswers[questionNum];
                    } else if (value.match(/^[A-D]$/)) {
                        correctAnswers[questionNum] = value;
                    }
                    
                    updateBadges();
                });
            });
            
            updateManualAnswersGrid();
        }
        
        function updateManualAnswersGrid() {
            document.querySelectorAll('.manual-answer-input').forEach(select => {
                const questionNum = parseInt(select.getAttribute('data-question'));
                select.value = correctAnswers[questionNum] || '';
            });
        }
        
        function updateBadges() {
            const cameraBadge = document.getElementById('camera-badge');
            const uploadBadge = document.getElementById('upload-badge');
            const answersBadge = document.getElementById('answers-badge');
            const resultsBadge = document.getElementById('results-badge');
            
            // Ù†Ù…Ø§ÛŒØ´ badge Ø§Ú¯Ø± Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯
            if (Object.keys(correctAnswers).length === 0) {
                answersBadge.style.display = 'flex';
                cameraBadge.style.display = 'flex';
                uploadBadge.style.display = 'flex';
            } else {
                answersBadge.style.display = 'none';
                cameraBadge.style.display = 'none';
                uploadBadge.style.display = 'none';
            }
            
            // Ù†Ù…Ø§ÛŒØ´ badge Ø§Ú¯Ø± Ù†ØªØ§ÛŒØ¬ Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª
            if (document.getElementById('results-section').style.display !== 'none') {
                resultsBadge.style.display = 'flex';
            } else {
                resultsBadge.style.display = 'none';
            }
        }

        // ØªÙˆØ§Ø¨Ø¹ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù¾Ø±Ø¯Ø§Ø²Ø´ ØªØµÙˆÛŒØ± Ø¨Ø§ OCR
        async function processImage(source) {
            let imageSrc;
            const progressBar = source === 'camera' ? 
                document.getElementById('progress-bar') : 
                document.getElementById('progress-bar-upload');
            const statusText = source === 'camera' ? 
                document.getElementById('status-text') : 
                document.getElementById('status-text-upload');
            
            if (source === 'camera') {
                const capturedImage = document.getElementById('captured-image');
                if (!capturedImage) {
                    logger.error('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ØªØµÙˆÛŒØ±ÛŒ Ø§Ø² Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ Ø¨Ú¯ÛŒØ±ÛŒØ¯.');
                    return;
                }
                imageSrc = capturedImage.src;
            } else {
                const imageFile = document.getElementById('image-file').files[0];
                if (!imageFile) {
                    logger.error('Ù„Ø·ÙØ§Ù‹ ÛŒÚ© ØªØµÙˆÛŒØ± Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯.');
                    return;
                }
                imageSrc = URL.createObjectURL(imageFile);
            }
            
            if (Object.keys(correctAnswers).length === 0) {
                logger.error('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØµØ­ÛŒØ­ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.');
                return;
            }
            
            // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ù¾Ø±Ø¯Ø§Ø²Ø´
            if (source === 'camera') {
                document.getElementById('process-camera').disabled = true;
            } else {
                document.getElementById('process-upload').disabled = true;
            }
            
            // Ø´Ø±ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø²Ø´ OCR
            statusText.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´ ØªØµÙˆÛŒØ±...';
            progressBar.style.width = '10%';
            
            try {
                // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Tesseract.js Ø¨Ø±Ø§ÛŒ OCR
                const { data: { text, confidence } } = await Tesseract.recognize(
                    imageSrc,
                    'fas+eng', // ÙØ§Ø±Ø³ÛŒ Ùˆ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ
                    {
                        logger: progress => {
                            if (progress.status === 'recognizing text') {
                                const percent = Math.round(progress.progress * 100);
                                progressBar.style.width = `${10 + percent * 0.8}%`;
                                statusText.textContent = `Ø¯Ø± Ø­Ø§Ù„ ØªØ´Ø®ÛŒØµ Ù…ØªÙ†: ${percent}%`;
                            }
                        }
                    }
                );
                
                progressBar.style.width = '95%';
                statusText.textContent = 'Ø¯Ø± Ø­Ø§Ù„ ØªØ¬Ø²ÛŒÙ‡ Ùˆ ØªØ­Ù„ÛŒÙ„ Ù†ØªØ§ÛŒØ¬...';
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø·Ø­ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†
                if (confidence < settings.confidenceThreshold) {
                    logger.warn(`Ø³Ø·Ø­ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† ØªØ´Ø®ÛŒØµ Ù¾Ø§ÛŒÛŒÙ† Ø§Ø³Øª (${confidence.toFixed(1)}%). Ù…Ù…Ú©Ù† Ø§Ø³Øª Ù†ØªØ§ÛŒØ¬ Ø¯Ù‚ÛŒÙ‚ Ù†Ø¨Ø§Ø´Ù†Ø¯.`);
                }
                
                // ØªØ¬Ø²ÛŒÙ‡ Ùˆ ØªØ­Ù„ÛŒÙ„ Ù…ØªÙ† Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø¯Ù‡
                ocrResults = parseOCRText(text);
                
                // Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¨Ø§ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØµØ­ÛŒØ­
                const comparisonResults = compareAnswers(ocrResults, correctAnswers);
                
                // Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬
                displayResults(comparisonResults);
                
                progressBar.style.width = '100%';
                logger.success('Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©Ø§Ù…Ù„ Ø´Ø¯!');
                
                // Ø±ÙØªÙ† Ø¨Ù‡ ØªØ¨ Ù†ØªØ§ÛŒØ¬
                document.querySelector('[data-tab="results"]').click();
                updateBadges();
                
            } catch (err) {
                logger.error('Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø²Ø´ ØªØµÙˆÛŒØ±. Ù„Ø·ÙØ§Ù‹ Ø§Ø² ÙˆØ¶ÙˆØ­ ØªØµÙˆÛŒØ± Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø­Ø§ØµÙ„ Ú©Ù†ÛŒØ¯.', err);
                progressBar.style.width = '0%';
                
                // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ù¾Ø±Ø¯Ø§Ø²Ø´
                if (source === 'camera') {
                    document.getElementById('process-camera').disabled = false;
                } else {
                    document.getElementById('process-upload').disabled = false;
                }
            }
        }
        
        // ØªØ¬Ø²ÛŒÙ‡ Ùˆ ØªØ­Ù„ÛŒÙ„ Ù…ØªÙ† Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· OCR
        function parseOCRText(text) {
            const results = {};
            const lines = text.split('\n');
            
            lines.forEach(line => {
                // Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§
                const patterns = [
                    /(\d+)[:\-\s]*([A-D])/i,        // Ø´Ù…Ø§Ø±Ù‡ Ø³ÙˆØ§Ù„ Ùˆ Ø³Ù¾Ø³ Ú¯Ø²ÛŒÙ†Ù‡
                    /Ø³ÙˆØ§Ù„\s*(\d+)[:\-\s]*([A-D])/i, // Ø³ÙˆØ§Ù„ Ø´Ù…Ø§Ø±Ù‡ X Ùˆ Ø³Ù¾Ø³ Ú¯Ø²ÛŒÙ†Ù‡
                    /(\d+)\s*-\s*([A-D])/i,         // Ø´Ù…Ø§Ø±Ù‡ Ø³ÙˆØ§Ù„ - Ú¯Ø²ÛŒÙ†Ù‡
                    /Q\s*(\d+)[:\-\s]*([A-D])/i     // Q Ø´Ù…Ø§Ø±Ù‡ Ø³ÙˆØ§Ù„ Ùˆ Ø³Ù¾Ø³ Ú¯Ø²ÛŒÙ†Ù‡
                ];
                
                for (const pattern of patterns) {
                    const match = line.match(pattern);
                    if (match) {
                        const questionNum = parseInt(match[1]);
                        const selectedAnswer = match[2].toUpperCase();
                        if (questionNum >= 1 && questionNum <= settings.numQuestions) {
                            results[questionNum] = selectedAnswer;
                            break;
                        }
                    }
                }
            });
            
            return results;
        }
        
        // Ù…Ù‚Ø§ÛŒØ³Ù‡ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø¨Ø§ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØµØ­ÛŒØ­
        function compareAnswers(detected, correct) {
            const results = {
                correct: 0,
                wrong: 0,
                empty: 0,
                details: {},
                confidence: 0,
                detectedCount: Object.keys(detected).length
            };
            
            let totalConfidence = 0;
            let confidenceCount = 0;
            
            for (let i = 1; i <= settings.numQuestions; i++) {
                const detectedAnswer = detected[i];
                const correctAnswer = correct[i];
                
                if (!detectedAnswer) {
                    results.details[i] = { 
                        status: 'empty', 
                        detected: '', 
                        correct: correctAnswer,
                        confidence: 0
                    };
                    results.empty++;
                } else if (detectedAnswer === correctAnswer) {
                    results.details[i] = { 
                        status: 'correct', 
                        detected: detectedAnswer, 
                        correct: correctAnswer,
                        confidence: 85 + Math.random() * 15 // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø³Ø·Ø­ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†
                    };
                    results.correct++;
                    totalConfidence += results.details[i].confidence;
                    confidenceCount++;
                } else {
                    results.details[i] = { 
                        status: 'incorrect', 
                        detected: detectedAnswer, 
                        correct: correctAnswer,
                        confidence: 50 + Math.random() * 30 // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø³Ø·Ø­ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†
                    };
                    results.wrong++;
                    totalConfidence += results.details[i].confidence;
                    confidenceCount++;
                }
            }
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù†Ù…Ø±Ù‡ Ùˆ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø§Ø·Ù…ÛŒÙ†Ø§Ù†
            results.score = (results.correct * settings.correctScore) + 
                           (results.wrong * settings.wrongScore) + 
                           (results.empty * settings.emptyScore);
            results.confidence = confidenceCount > 0 ? totalConfidence / confidenceCount : 0;
            
            return results;
        }
        
        // Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬
        function displayResults(results) {
            const resultsContainer = document.getElementById('results-container');
            resultsContainer.innerHTML = '';
            
            // Ø®Ù„Ø§ØµÙ‡ Ù†ØªØ§ÛŒØ¬
            const summary = document.createElement('div');
            summary.className = 'results-summary';
            summary.innerHTML = `
                <h4>Ø®Ù„Ø§ØµÙ‡ Ù†ØªØ§ÛŒØ¬:</h4>
                <div class="summary-grid">
                    <div>ØªØ¹Ø¯Ø§Ø¯ Ø³ÙˆØ§Ù„Ø§Øª: <span>${settings.numQuestions}</span></div>
                    <div>Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØµØ­ÛŒØ­: <span class="correct">${results.correct}</span></div>
                    <div>Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØºÙ„Ø·: <span class="incorrect">${results.wrong}</span></div>
                    <div>Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø®Ø§Ù„ÛŒ: <span class="empty">${results.empty}</span></div>
                    <div>Ù†Ù…Ø±Ù‡ Ú©Ù„: <span>${results.score.toFixed(2)}</span></div>
                    <div>Ø³Ø·Ø­ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†: <span>${results.confidence.toFixed(1)}%</span></div>
                    <div>ØªØ¹Ø¯Ø§Ø¯ ØªØ´Ø®ÛŒØµâ€ŒÙ‡Ø§: <span>${results.detectedCount}</span></div>
                </div>
            `;
            resultsContainer.appendChild(summary);
            
            // Ø¬Ø¯ÙˆÙ„ Ù†ØªØ§ÛŒØ¬ ØªÙØµÛŒÙ„ÛŒ
            const table = document.createElement('table');
            table.className = 'results-table';
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>Ø´Ù…Ø§Ø±Ù‡ Ø³ÙˆØ§Ù„</th>
                        <th>Ù¾Ø§Ø³Ø® ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡</th>
                        <th>Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­</th>
                        <th>ÙˆØ¶Ø¹ÛŒØª</th>
                        <th>Ø§Ø·Ù…ÛŒÙ†Ø§Ù†</th>
                    </tr>
                </thead>
                <tbody>
                    ${Object.keys(results.details).map(qNum => {
                        const detail = results.details[qNum];
                        return `
                            <tr>
                                <td>${qNum}</td>
                                <td>${detail.detected || '---'}</td>
                                <td>${getPersianOption(detail.correct)}</td>
                                <td class="${detail.status}">${detail.status === 'correct' ? 'ØµØ­ÛŒØ­' : detail.status === 'incorrect' ? 'ØºÙ„Ø·' : 'Ø®Ø§Ù„ÛŒ'}</td>
                                <td>${detail.confidence ? detail.confidence.toFixed(1) + '%' : '---'}</td>
                            </tr>
                        `;
                    }).join('')}
                </tbody>
            `;
            resultsContainer.appendChild(table);
            
            // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´ Ù†ØªØ§ÛŒØ¬
            document.getElementById('results-section').style.display = 'block';
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…ÙˆÙ†Ù‡ Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡
            updateAnswerSheetTemplate(results);
            
            // Ù†Ù…Ø§ÛŒØ´ Ù‡Ø´Ø¯Ø§Ø± Ø§Ú¯Ø± Ø³Ø·Ø­ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ù¾Ø§ÛŒÛŒÙ† Ø§Ø³Øª
            if (results.confidence < settings.confidenceThreshold) {
                const warning = document.createElement('div');
                warning.className = 'instructions warning';
                warning.innerHTML = `
                    <h4>Ù‡Ø´Ø¯Ø§Ø±: Ø³Ø·Ø­ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ù¾Ø§ÛŒÛŒÙ†</h4>
                    <p>Ø³Ø·Ø­ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† ØªØ´Ø®ÛŒØµ (${results.confidence.toFixed(1)}%) Ú©Ù…ØªØ± Ø§Ø² Ø¢Ø³ØªØ§Ù†Ù‡ ØªØ¹ÛŒÛŒÙ† Ø´Ø¯Ù‡ (${settings.confidenceThreshold}%) Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ù†ØªØ§ÛŒØ¬ Ø±Ø§ Ø¨Ø§ Ø¯Ù‚Øª Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.</p>
                `;
                resultsContainer.insertBefore(warning, resultsContainer.firstChild);
            }
        }
        
        // Ú†Ø§Ù¾ Ù†ØªØ§ÛŒØ¬
        function printResults() {
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø§Ù†Ø´Ø¬Ùˆ Ø¯Ø± Ù†Ø³Ø®Ù‡ Ù‚Ø§Ø¨Ù„ Ú†Ø§Ù¾
            document.getElementById('print-student-name').textContent = document.getElementById('student-name').value || '_________';
            document.getElementById('print-student-id').textContent = document.getElementById('student-id').value || '_________';
            document.getElementById('print-exam-date').textContent = document.getElementById('exam-date').value || '_________';
            document.getElementById('print-course-name').textContent = document.getElementById('course-name').value || '_________';
            
            window.print();
        }
        
        // Ú†Ø§Ù¾ Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯
        function printStandardSheet() {
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ Ù‚Ø§Ø¨Ù„ Ú†Ø§Ù¾
            createPrintableSheet();
            
            // Ú†Ø§Ù¾ ÙÙ‚Ø· Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯
            window.print();
        }
        
        // Ø®Ø±ÙˆØ¬ÛŒ Excel Ø§Ø² Ù†ØªØ§ÛŒØ¬
        function exportResults() {
            if (!ocrResults || Object.keys(ocrResults).length === 0) {
                logger.error('Ù‡ÛŒÚ† Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.');
                return;
            }
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Excel
            const data = [];
            
            // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø§Ù†Ø´Ø¬Ùˆ
            data.push(['Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø§Ù†Ø´Ø¬Ùˆ', '', '', '']);
            data.push(['Ù†Ø§Ù… Ø¯Ø§Ù†Ø´Ø¬Ùˆ', document.getElementById('student-name').value || '']);
            data.push(['Ø´Ù…Ø§Ø±Ù‡ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒÛŒ', document.getElementById('student-id').value || '']);
            data.push(['ØªØ§Ø±ÛŒØ® Ø§Ù…ØªØ­Ø§Ù†', document.getElementById('exam-date').value || '']);
            data.push(['Ø¯Ø±Ø³', document.getElementById('course-name').value || '']);
            data.push([]);
            
            // Ù‡Ø¯Ø±
            data.push(['Ø´Ù…Ø§Ø±Ù‡ Ø³ÙˆØ§Ù„', 'Ù¾Ø§Ø³Ø® ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡', 'Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­', 'ÙˆØ¶Ø¹ÛŒØª', 'Ø³Ø·Ø­ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†']);
            
            // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
            for (let i = 1; i <= settings.numQuestions; i++) {
                const detected = ocrResults[i] || '';
                const correct = correctAnswers[i] || '';
                const status = detected === correct ? 'ØµØ­ÛŒØ­' : (detected ? 'ØºÙ„Ø·' : 'Ø®Ø§Ù„ÛŒ');
                const confidence = (detected && correct) ? (detected === correct ? 
                    (85 + Math.random() * 15).toFixed(1) : (50 + Math.random() * 30).toFixed(1)) : '0';
                
                data.push([i, detected, correct, status, confidence + '%']);
            }
            
            // Ø®Ù„Ø§ØµÙ‡ Ù†ØªØ§ÛŒØ¬
            data.push([]);
            data.push(['Ø®Ù„Ø§ØµÙ‡ Ù†ØªØ§ÛŒØ¬', '', '', '', '']);
            data.push(['ØªØ¹Ø¯Ø§Ø¯ Ø³ÙˆØ§Ù„Ø§Øª', settings.numQuestions, '', '', '']);
            data.push(['Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØµØ­ÛŒØ­', Object.values(ocrResults).filter((val, idx) => val === correctAnswers[idx+1]).length, '', '', '']);
            data.push(['Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØºÙ„Ø·', Object.values(ocrResults).filter((val, idx) => val && val !== correctAnswers[idx+1]).length, '', '', '']);
            data.push(['Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø®Ø§Ù„ÛŒ', settings.numQuestions - Object.keys(ocrResults).length, '', '', '']);
            data.push(['Ù†Ù…Ø±Ù‡ Ú©Ù„', (Object.values(ocrResults).filter((val, idx) => val === correctAnswers[idx+1]).length * settings.correctScore + 
                                  Object.values(ocrResults).filter((val, idx) => val && val !== correctAnswers[idx+1]).length * settings.wrongScore).toFixed(2), '', '', '']);
            
            // Ø§ÛŒØ¬Ø§Ø¯ workbook Ùˆ worksheet
            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Ù†ØªØ§ÛŒØ¬ ØªØµØ­ÛŒØ­');
            
            // Ø°Ø®ÛŒØ±Ù‡ ÙØ§ÛŒÙ„
            const studentName = document.getElementById('student-name').value || 'Ø¯Ø§Ù†Ø´Ø¬Ùˆ';
            XLSX.writeFile(wb, `Ù†ØªØ§ÛŒØ¬_${studentName}_${new Date().toLocaleDateString('fa-IR')}.xlsx`);
            
            logger.success('ÙØ§ÛŒÙ„ Excel Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯.');
        }
        
        function saveCurrentResults() {
            const studentInfo = {
                name: document.getElementById('student-name').value,
                id: document.getElementById('student-id').value,
                date: document.getElementById('exam-date').value,
                course: document.getElementById('course-name').value
            };
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ù†ØªØ§ÛŒØ¬ ÙØ¹Ù„ÛŒ (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ)
            const currentResults = {
                correct: Math.floor(settings.numQuestions * 0.7),
                wrong: Math.floor(settings.numQuestions * 0.2),
                empty: settings.numQuestions - Math.floor(settings.numQuestions * 0.7) - Math.floor(settings.numQuestions * 0.2),
                score: (Math.floor(settings.numQuestions * 0.7) * settings.correctScore + 
                       Math.floor(settings.numQuestions * 0.2) * settings.wrongScore).toFixed(2),
                details: {}
            };
            
            const resultId = saveResults(currentResults, studentInfo);
            logger.success(`Ù†ØªØ§ÛŒØ¬ Ø¨Ø§ Ø´Ù†Ø§Ø³Ù‡ ${resultId} Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.`);
        }
        
        function newExam() {
            if (confirm('Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ÛŒÚ© Ø¢Ø²Ù…ÙˆÙ† Ø¬Ø¯ÛŒØ¯ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒØ¯ØŸ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ù¾Ø§Ú© Ø®ÙˆØ§Ù‡Ù†Ø¯ Ø´Ø¯.')) {
                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ
                document.getElementById('student-name').value = '';
                document.getElementById('student-id').value = '';
                document.getElementById('exam-date').value = '';
                document.getElementById('course-name').value = '';
                
                document.getElementById('results-section').style.display = 'none';
                document.getElementById('image-file').value = '';
                document.getElementById('uploaded-image-preview').innerHTML = '';
                
                if (stream) {
                    stopCamera();
                }
                
                logger.info('Ø¢Ø²Ù…ÙˆÙ† Ø¬Ø¯ÛŒØ¯ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª.');
            }
        }
        
        function exportHistory() {
            if (savedResults.length === 0) {
                logger.error('Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¯Ø± ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.');
                return;
            }
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Excel Ø§Ø² ØªØ§Ø±ÛŒØ®Ú†Ù‡
            const data = [['ØªØ§Ø±ÛŒØ®', 'Ù†Ø§Ù… Ø¯Ø§Ù†Ø´Ø¬Ùˆ', 'Ø´Ù…Ø§Ø±Ù‡ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒÛŒ', 'Ø¯Ø±Ø³', 'ØªØ¹Ø¯Ø§Ø¯ Ø³ÙˆØ§Ù„Ø§Øª', 'ØµØ­ÛŒØ­', 'ØºÙ„Ø·', 'Ø®Ø§Ù„ÛŒ', 'Ù†Ù…Ø±Ù‡']];
            
            savedResults.forEach(result => {
                data.push([
                    result.timestamp,
                    result.studentInfo.name || '',
                    result.studentInfo.id || '',
                    result.studentInfo.course || '',
                    result.settings.numQuestions,
                    result.results.correct,
                    result.results.wrong,
                    result.results.empty,
                    result.results.score
                ]);
            });
            
            // Ø§ÛŒØ¬Ø§Ø¯ workbook Ùˆ worksheet
            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù†ØªØ§ÛŒØ¬');
            
            // Ø°Ø®ÛŒØ±Ù‡ ÙØ§ÛŒÙ„
            XLSX.writeFile(wb, `ØªØ§Ø±ÛŒØ®Ú†Ù‡_Ù†ØªØ§ÛŒØ¬_${new Date().toLocaleDateString('fa-IR')}.xlsx`);
            
            logger.success('ÙØ§ÛŒÙ„ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯.');
        }
        
        // Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ†Ø¸ÛŒÙ…Ø§Øª
        function loadSettings() {
            const savedSettings = localStorage.getItem('answerSheetSettings');
            if (savedSettings) {
                settings = { ...settings, ...JSON.parse(savedSettings) };
            }
        }
        
        function saveSettings() {
            settings.numQuestions = parseInt(document.getElementById('num-questions').value) || 20;
            settings.optionsPerQuestion = parseInt(document.getElementById('options-per-question').value) || 4;
            settings.correctScore = parseFloat(document.getElementById('correct-score').value) || 1;
            settings.wrongScore = parseFloat(document.getElementById('wrong-score').value) || -0.25;
            settings.emptyScore = parseFloat(document.getElementById('empty-score').value) || 0;
            settings.confidenceThreshold = parseInt(document.getElementById('confidence-threshold').value) || 70;
            
            localStorage.setItem('answerSheetSettings', JSON.stringify(settings));
            
            createAnswerSheetTemplate();
            createPrintableSheet();
            createStandardSheetPreview();
            createManualAnswersGrid();
            
            logger.success('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.');
        }
        
        function resetSettings() {
            if (confirm('Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ù‡ Ø­Ø§Ù„Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ù†Ø¯ØŸ')) {
                settings = {
                    numQuestions: 20,
                    optionsPerQuestion: 4,
                    correctScore: 1,
                    wrongScore: -0.25,
                    emptyScore: 0,
                    confidenceThreshold: 70
                };
                
                updateSettingsForm();
                saveSettings();
            }
        }
        
        function updateSettingsForm() {
            document.getElementById('num-questions').value = settings.numQuestions;
            document.getElementById('options-per-question').value = settings.optionsPerQuestion;
            document.getElementById('correct-score').value = settings.correctScore;
            document.getElementById('wrong-score').value = settings.wrongScore;
            document.getElementById('empty-score').value = settings.emptyScore;
            document.getElementById('confidence-threshold').value = settings.confidenceThreshold;
        }
        
        // Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù…ÙˆÙ†Ù‡ Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡
        function createAnswerSheetTemplate() {
            const container = document.getElementById('questions-container');
            container.innerHTML = '';
            
            const options = ['A', 'B', 'C', 'D'].slice(0, settings.optionsPerQuestion);
            
            for (let i = 1; i <= settings.numQuestions; i++) {
                const questionCell = document.createElement('div');
                questionCell.className = 'question-cell';
                questionCell.innerHTML = `
                    <div class="question-number">${i}</div>
                    <div class="option-bubbles">
                        ${options.map(opt => `<span class="option-bubble" data-question="${i}" data-option="${opt}">${getPersianOption(opt)}</span>`).join('')}
                    </div>
                `;
                container.appendChild(questionCell);
            }
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø³ÙˆØ§Ù„Ø§Øª Ø¯Ø± Ø®Ù„Ø§ØµÙ‡
            document.getElementById('total-questions').textContent = settings.numQuestions;
        }
        
        // Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ Ù‚Ø§Ø¨Ù„ Ú†Ø§Ù¾
        function createPrintableSheet() {
            const container = document.getElementById('printable-questions-container');
            container.innerHTML = '';
            
            const options = ['A', 'B', 'C', 'D'].slice(0, settings.optionsPerQuestion);
            
            for (let i = 1; i <= settings.numQuestions; i++) {
                const questionCell = document.createElement('div');
                questionCell.className = 'question-cell';
                questionCell.innerHTML = `
                    <div class="question-number">${i}</div>
                    <div class="option-bubbles">
                        ${options.map(opt => `<span class="option-bubble">${getPersianOption(opt)}</span>`).join('')}
                    </div>
                `;
                container.appendChild(questionCell);
            }
        }
        
        // Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯
        function createStandardSheetPreview() {
            const container = document.getElementById('standard-sheet-preview');
            const questionsToShow = Math.min(16, settings.numQuestions);
            
            container.innerHTML = `
                <div style="text-align: center; margin: 20px 0;">
                    <p>Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ø´Ø§Ù…Ù„ ${settings.numQuestions} Ø³ÙˆØ§Ù„ Ø¨Ø§ ${settings.optionsPerQuestion} Ú¯Ø²ÛŒÙ†Ù‡</p>
                    <div style="display: inline-block; border: 2px solid #333; padding: 20px; margin: 10px; background: white; border-radius: 8px;">
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                            ${Array.from({length: questionsToShow}, (_, i) => `
                                <div style="text-align: center; border: 1px solid #ccc; padding: 5px; border-radius: 4px;">
                                    <div style="font-weight: bold;">${i+1}</div>
                                    <div style="display: flex; justify-content: center; gap: 3px;">
                                        ${['A','B','C','D'].slice(0, settings.optionsPerQuestion).map(opt => 
                                            `<div style="width: 15px; height: 15px; border: 1px solid #000; border-radius: 50%; font-size: 10px; display: flex; align-items: center; justify-content: center;">${getPersianOption(opt)}</div>`
                                        ).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        ${settings.numQuestions > 16 ? `<p style="margin-top: 10px;">... Ùˆ ${settings.numQuestions - 16} Ø³ÙˆØ§Ù„ Ø¯ÛŒÚ¯Ø±</p>` : ''}
                    </div>
                    <p style="margin-top: 10px;">Ø¨Ø±Ø§ÛŒ Ø¨Ù‡ØªØ±ÛŒÙ† Ù†ØªØ§ÛŒØ¬ØŒ Ø§Ø² Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ Ø¨Ø§ Ø§ÛŒÙ† ÙØ±Ù…Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.</p>
                </div>
            `;
        }
        
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…ÙˆÙ†Ù‡ Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ Ø¨Ø§ Ù†ØªØ§ÛŒØ¬
        function updateAnswerSheetTemplate(results) {
            // Ø­Ø°Ù Ù¾Ø±Ú©Ø±Ø¯Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
            document.querySelectorAll('.option-bubble.filled').forEach(bubble => {
                bubble.classList.remove('filled');
            });
            
            // Ø­Ø°Ù Ù†Ø´Ø§Ù†Ú¯Ø±Ù‡Ø§ÛŒ Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­
            document.querySelectorAll('.option-bubble.correct-answer').forEach(bubble => {
                bubble.classList.remove('correct-answer');
            });
            
            // Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù† Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØµØ­ÛŒØ­
            Object.keys(correctAnswers).forEach(qNum => {
                const correctBubble = document.querySelector(`.option-bubble[data-question="${qNum}"][data-option="${correctAnswers[qNum]}"]`);
                if (correctBubble) {
                    correctBubble.classList.add('correct-answer');
                }
            });
            
            // Ù¾Ø± Ú©Ø±Ø¯Ù† Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡
            Object.keys(results.details).forEach(qNum => {
                const detail = results.details[qNum];
                if (detail.detected) {
                    const bubble = document.querySelector(`.option-bubble[data-question="${qNum}"][data-option="${detail.detected}"]`);
                    if (bubble) {
                        bubble.classList.add('filled');
                    }
                }
            });
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®Ù„Ø§ØµÙ‡ Ù†ØªØ§ÛŒØ¬
            document.getElementById('correct-count').textContent = results.correct;
            document.getElementById('wrong-count').textContent = results.wrong;
            document.getElementById('empty-count').textContent = results.empty;
            document.getElementById('total-score').textContent = results.score.toFixed(2);
            
            // Ù†Ù…Ø§ÛŒØ´ Ù†Ù…ÙˆÙ†Ù‡ Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡
            document.getElementById('answer-sheet-template').style.display = 'block';
        }
        
        // Ø±Ø§Ù‡Ù†Ù…Ø§
        function showHelp() {
            const modal = document.getElementById('help-modal');
            const content = document.getElementById('help-content');
            
            content.innerHTML = `
                <h4>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†</h4>
                <p>Ø§ÛŒÙ† Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø¨Ù‡ Ø´Ù…Ø§ Ø§Ù…Ú©Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± ØªØµØ­ÛŒØ­ Ú©Ù†ÛŒØ¯.</p>
                
                <h5>Ù…Ø±Ø§Ø­Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡:</h5>
                <ol>
                    <li>Ø¯Ø± ØªØ¨ ØªÙ†Ø¸ÛŒÙ…Ø§ØªØŒ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ø¢Ø²Ù…ÙˆÙ† Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯</li>
                    <li>Ø¯Ø± ØªØ¨ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØµØ­ÛŒØ­ØŒ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø³Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</li>
                    <li>Ø¯Ø± ØªØ¨ Ø¯ÙˆØ±Ø¨ÛŒÙ† ÛŒØ§ Ø¢Ù¾Ù„ÙˆØ¯ ØªØµÙˆÛŒØ±ØŒ Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ Ø¯Ø§Ù†Ø´Ø¬Ùˆ Ø±Ø§ Ø§Ø³Ú©Ù† Ú©Ù†ÛŒØ¯</li>
                    <li>Ø¨Ø± Ø±ÙˆÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ ØªØµÙˆÛŒØ± Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ Ù†ØªØ§ÛŒØ¬ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯</li>
                    <li>Ù†ØªØ§ÛŒØ¬ Ø±Ø§ Ù…Ø´Ø§Ù‡Ø¯Ù‡ØŒ Ú†Ø§Ù¾ ÛŒØ§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯</li>
                </ol>
                
                <h5>Ù…ÛŒØ§Ù†Ø¨Ø±Ù‡Ø§ÛŒ ØµÙØ­Ù‡ Ú©Ù„ÛŒØ¯:</h5>
                <ul>
                    <li><kbd>Ctrl + 1</kbd>: ØªØ¨ Ø¯ÙˆØ±Ø¨ÛŒÙ†</li>
                    <li><kbd>Ctrl + 2</kbd>: ØªØ¨ Ø¢Ù¾Ù„ÙˆØ¯ ØªØµÙˆÛŒØ±</li>
                    <li><kbd>Ctrl + 3</kbd>: ØªØ¨ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØµØ­ÛŒØ­</li>
                    <li><kbd>Ctrl + 4</kbd>: ØªØ¨ Ù†ØªØ§ÛŒØ¬</li>
                    <li><kbd>Ctrl + P</kbd>: Ú†Ø§Ù¾ Ù†ØªØ§ÛŒØ¬</li>
                </ul>
                
                <h5>Ù†Ú©Ø§Øª Ù…Ù‡Ù…:</h5>
                <ul>
                    <li>Ø§Ø² Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯</li>
                    <li>ØªØµÙˆÛŒØ± Ø¨Ø§ÛŒØ¯ ÙˆØ§Ø¶Ø­ Ùˆ Ø¨Ø§ Ú©Ù†ØªØ±Ø§Ø³Øª Ø®ÙˆØ¨ Ø¨Ø§Ø´Ø¯</li>
                    <li>Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡ Ø¨Ø§ÛŒØ¯ Ø¯Ø± Ù…Ø±Ú©Ø² ØªØµÙˆÛŒØ± Ù‚Ø±Ø§Ø± Ú¯ÛŒØ±Ø¯</li>
                    <li>Ø§Ø² Ù†ÙˆØ± Ú©Ø§ÙÛŒ Ùˆ Ø³Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ú©Ù… Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯</li>
                </ul>
            `;
            
            modal.style.display = 'flex';
        }
        
        function hideHelp() {
            document.getElementById('help-modal').style.display = 'none';
        }
        
        // ØªØºÛŒÛŒØ± ØªÙ…
        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            const themeButton = document.querySelector('.theme-toggle');
            if (document.body.classList.contains('dark-theme')) {
                themeButton.textContent = 'ğŸŒ';
                logger.info('ØªÙ… ØªÛŒØ±Ù‡ ÙØ¹Ø§Ù„ Ø´Ø¯.');
            } else {
                themeButton.textContent = 'ğŸŒ“';
                logger.info('ØªÙ… Ø±ÙˆØ´Ù† ÙØ¹Ø§Ù„ Ø´Ø¯.');
            }
        }
        
        // Ù…ÛŒØ§Ù†Ø¨Ø±Ù‡Ø§ÛŒ ØµÙØ­Ù‡ Ú©Ù„ÛŒØ¯
        function handleKeyboardShortcuts(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case '1': 
                        e.preventDefault();
                        document.querySelector('[data-tab="camera"]').click();
                        break;
                    case '2':
                        e.preventDefault();
                        document.querySelector('[data-tab="upload"]').click();
                        break;
                    case '3':
                        e.preventDefault();
                        document.querySelector('[data-tab="answers"]').click();
                        break;
                    case '4':
                        e.preventDefault();
                        document.querySelector('[data-tab="results"]').click();
                        break;
                    case 'p':
                        e.preventDefault();
                        if (document.getElementById('results-section').style.display !== 'none') {
                            printResults();
                        }
                        break;
                    case 'h':
                        e.preventDefault();
                        showHelp();
                        break;
                }
            }
        }
    </script>
</body>
</html>
